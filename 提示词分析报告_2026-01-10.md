# RDAgent æç¤ºè¯åˆ†ææŠ¥å‘Šï¼ˆæ›´æ–°ç‰ˆï¼‰

**æ—¥æœŸ**: 2026-01-10
**åˆ†æèŒƒå›´**: RDAgent å› å­ç ”å‘é˜¶æ®µæç¤ºè¯
**ç›®çš„**: è¯†åˆ«æœ¬æ¬¡ `qlib_factor_interface` æ¨¡å—åŒ–æ”¹é€ åä»å­˜åœ¨çš„ä¸åˆç†æç¤ºè¯

**é‡è¦è¯´æ˜**ï¼š
- æœ¬æŠ¥å‘Šä»…é’ˆå¯¹**å› å­ç ”å‘é˜¶æ®µ**çš„æç¤ºè¯
- UI å±•ç¤ºç›¸å…³æç¤ºè¯ï¼ˆ`rich_style_description`ï¼‰ä¿ç•™ï¼Œä¸çº³å…¥ä¼˜åŒ–èŒƒå›´
- å› å­å®¡æ ¸æç¤ºè¯ï¼ˆ`evaluator_*`ï¼‰å±äºå› å­ç ”å‘é˜¶æ®µï¼Œä¿®æ”¹ä¼šå½±å“å› å­ç ”å‘è¿‡ç¨‹

---

## ä¿®æ”¹è®°å½•æ¨¡æ¿

### ä¿®æ”¹è®°å½•æ ¼å¼

æ¯æ¬¡ä¿®æ”¹æç¤ºè¯æ—¶ï¼Œè¯·åœ¨æŠ¥å‘Šæœ«å°¾æ·»åŠ ä»¥ä¸‹æ ¼å¼çš„ä¿®æ”¹è®°å½•ï¼š

```markdown
### ä¿®æ”¹è®°å½• - YYYY-MM-DD

**ä¿®æ”¹äºº**: [å§“å]
**ä¿®æ”¹æ—¶é—´**: YYYY-MM-DD HH:MM:SS
**ä¿®æ”¹åŸå› **: [ç®€è¦è¯´æ˜]

#### å¤‡ä»½ä¿¡æ¯

| æ–‡ä»¶ | å¤‡ä»½æ–‡ä»¶ | å¤‡ä»½æ—¶é—´ |
|------|---------|---------|
| `æ–‡ä»¶è·¯å¾„` | `å¤‡ä»½æ–‡ä»¶è·¯å¾„` | YYYY-MM-DD HH:MM:SS |

#### ä¿®æ”¹å†…å®¹

| æç¤ºè¯é”®å | ä¿®æ”¹å‰ | ä¿®æ”¹å | å½±å“èŒƒå›´ |
|-----------|--------|--------|---------|
| `æç¤ºè¯åç§°` | [ä¿®æ”¹å‰å†…å®¹æ‘˜è¦] | [ä¿®æ”¹åå†…å®¹æ‘˜è¦] | [å½±å“èŒƒå›´] |

#### æ¢å¤æ–¹æ³•

```bash
# æ¢å¤å‘½ä»¤
cp å¤‡ä»½æ–‡ä»¶è·¯å¾„ åŸæ–‡ä»¶è·¯å¾„
```

#### éªŒè¯æ–¹æ³•

[å¦‚ä½•éªŒè¯ä¿®æ”¹æ˜¯å¦æ­£ç¡®]
```

---

## å¤‡ä»½æ¢å¤æ–¹æ³•

### å½“å‰å¤‡ä»½çŠ¶æ€

| æ–‡ä»¶ | å¤‡ä»½æ–‡ä»¶ | å¤‡ä»½æ—¥æœŸ | çŠ¶æ€ |
|------|---------|---------|------|
| `rdagent/scenarios/qlib/experiment/prompts.yaml` | `prompts.yaml.backup_20260109` | 2026-01-09 | âœ… å­˜åœ¨ |
| `rdagent/components/coder/factor_coder/prompts.yaml` | `prompts.yaml.backup_20260110` | 2026-01-10 | âœ… å­˜åœ¨ |

### æ¢å¤æ–¹æ³•

#### æ¢å¤å› å­ç ”å‘é˜¶æ®µæç¤ºè¯

```bash
# æ¢å¤ prompts.yaml
cp rdagent/scenarios/qlib/experiment/prompts.yaml.backup_20260109 rdagent/scenarios/qlib/experiment/prompts.yaml

# åˆ é™¤æ–°å¢çš„æ¨¡å—æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦å®Œå…¨æ¢å¤ï¼‰
rm rdagent/scenarios/qlib/experiment/prompts_core_constraints.yaml
rm rdagent/scenarios/qlib/experiment/prompts_data_loading.yaml
rm rdagent/scenarios/qlib/experiment/prompts_error_prevention.yaml
rm rdagent/scenarios/qlib/experiment/prompts_dataset_info.yaml
rm rdagent/scenarios/qlib/experiment/prompts_language_spec.yaml
```

#### æ¢å¤å› å­å®¡æ ¸é˜¶æ®µæç¤ºè¯

```bash
# æ¢å¤ factor_coder/prompts.yaml
cp rdagent/components/coder/factor_coder/prompts.yaml.backup_20260110 rdagent/components/coder/factor_coder/prompts.yaml
```

### è¯Šæ–­æµç¨‹

å¦‚æœæç¤ºè¯ä¿®æ”¹åå‡ºç°é—®é¢˜ï¼ŒæŒ‰ä»¥ä¸‹æµç¨‹è¯Šæ–­ï¼š

1. **æ£€æŸ¥ä¿®æ”¹è®°å½•**ï¼šæŸ¥çœ‹æœ¬æŠ¥å‘Šä¸­çš„ä¿®æ”¹è®°å½•ï¼Œç¡®è®¤ä¿®æ”¹å†…å®¹
2. **æ£€æŸ¥å¤‡ä»½æ–‡ä»¶**ï¼šç¡®è®¤å¤‡ä»½æ–‡ä»¶å­˜åœ¨ä¸”å®Œæ•´
3. **æ¢å¤å¤‡ä»½**ï¼šä½¿ç”¨ä¸Šè¿°æ¢å¤æ–¹æ³•æ¢å¤åˆ°ä¿®æ”¹å‰çš„çŠ¶æ€
4. **éªŒè¯æ¢å¤**ï¼šè¿è¡Œæµ‹è¯•ç¡®è®¤æ¢å¤æˆåŠŸ
5. **åˆ†æé—®é¢˜**ï¼šæ ¹æ®ä¿®æ”¹è®°å½•åˆ†æé—®é¢˜åŸå› 
6. **é‡æ–°ä¿®æ”¹**ï¼šè°ƒæ•´ä¿®æ”¹æ–¹æ¡ˆåé‡æ–°æ‰§è¡Œ

---

## ä¸€ã€å·²å®Œæˆä¼˜åŒ–

### âœ… å·²è§£å†³é—®é¢˜

| é—®é¢˜ | åŸçŠ¶æ€ | ä¼˜åŒ–åçŠ¶æ€ | æ•ˆæœ |
|------|--------|------------|------|
| `qlib_factor_interface` ä¿¡æ¯è¿‡è½½ | 140è¡Œå•æ–‡ä»¶ | æ‹†åˆ†ä¸º5ä¸ªæ¨¡å—æ–‡ä»¶ | ä¸»æ–‡ä»¶å‡å°‘35%ï¼Œç»“æ„æ¸…æ™° |
| ç¼ºå°‘é”™è¯¯é¢„é˜² | æ—  | æ–°å¢ `prompts_error_prevention.yaml` | åŒ…å«5ä¸ªå¸¸è§é”™è¯¯æ¡ˆä¾‹ |
| çº¦æŸåˆ†æ•£ | æ··æ‚åœ¨ä¸€èµ· | æŒ‰åŠŸèƒ½æ¨¡å—åŒ– | æ ¸å¿ƒçº¦æŸã€æ•°æ®åŠ è½½ã€é”™è¯¯é¢„é˜²åˆ†ç¦» |

---

## äºŒã€ä»å­˜åœ¨çš„ä¸åˆç†æç¤ºè¯

### ğŸ”´ ä¸¥é‡é—®é¢˜ï¼ˆP0ï¼‰

#### é—®é¢˜1ï¼š`qlib_factor_strategy` åŒ…å« `reset_index()` é”™è¯¯å¼•å¯¼

**æ–‡ä»¶**: `rdagent/scenarios/qlib/experiment/prompts.yaml` ç¬¬53-92è¡Œ

**é—®é¢˜æè¿°**:
- ç¬¬65-70è¡Œå±•ç¤ºäº† `reset_index()` çš„ç¤ºä¾‹ä»£ç ï¼Œæ²¡æœ‰è¯´æ˜å¦‚ä½•æ¢å¤ç´¢å¼•
- è¿™ä¸ `prompts_error_prevention.yaml` ä¸­"ä¸¥ç¦ä½¿ç”¨ `reset_index(drop=True)`"çš„çº¦æŸå†²çª
- LLM å¯èƒ½ä¼šæ¨¡ä»¿ç¤ºä¾‹ä»£ç ï¼Œå¯¼è‡´ç´¢å¼•ç»“æ„é”™è¯¯

**å…·ä½“ä»£ç **:
```yaml
qlib_factor_strategy: |-
  # ...
  2. **Reset the index if necessary**:
    ```python
    # Resetting the index to move 'datetime' and 'instrument' from the index to columns.
    # This operation flattens the multi-index structure.
    df = df.reset_index()
    ```
```

**å½±å“**:
- å¯¼è‡´ LLM åœ¨å› å­ç¼–ç æ—¶é”™è¯¯åœ°ä½¿ç”¨ `reset_index()`
- ç ´å MultiIndex ç»“æ„ï¼Œå¼•å‘åç»­æ“ä½œå¤±è´¥
- ä¸æ ¸å¿ƒçº¦æŸçŸ›ç›¾ï¼Œé€ æˆ LLM æ··æ·†

**reset_index() ä½¿ç”¨è§„åˆ™**:
| æ“ä½œ | æ˜¯å¦å…è®¸ | è¯´æ˜ |
|------|---------|------|
| `df.index.get_level_values()` | âœ… å…è®¸ | æ¨èï¼Œç”¨äºè·å–ç´¢å¼•å€¼ |
| `reset_index()` åå†æ¢å¤ | âŒ ä¸å¿…è¦ | å¯ä»¥ç”¨ `get_level_values()` æ›¿ä»£ |
| `reset_index(drop=True)` | âŒ ç¦æ­¢ | ç ´åç´¢å¼•ç»“æ„ |
| `droplevel()` / `swaplevel()` | âŒ ç¦æ­¢ | ç ´åç´¢å¼•ç»“æ„ |
| `reset_index(level=0, drop=True)` | âœ… å…è®¸ | **å¿…é¡»å…è®¸**ï¼Œç”¨äº `groupby+rolling` åæ¢å¤ç´¢å¼• |

**å»ºè®®ä¿®æ”¹**:
```yaml
qlib_factor_strategy: |-
  ç¡®ä¿æ¯ä¸€æ­¥æ•°æ®å¤„ç†æ“ä½œéƒ½é€šè¿‡æ³¨é‡Šæ¸…æ™°è¯´æ˜æ•°æ®æ ¼å¼ï¼ˆåŒ…æ‹¬ç´¢å¼•ç»“æ„ï¼‰ã€‚

  **é‡è¦çº¦æŸ**ï¼š
  - åœ¨æœ¬é¡¹ç›®å› å­ç¼–ç ä¸­ï¼Œ**ä¸¥ç¦**åœ¨æœ€ç»ˆç»“æœä¸Šä½¿ç”¨ `reset_index(drop=True)`ã€`droplevel()`ã€`swaplevel()` ç­‰ä¼šæ”¹å˜ç´¢å¼•ç»“æ„çš„æ“ä½œ
  - å§‹ç»ˆä¿æŒ MultiIndex(`datetime`, `instrument`) ç»“æ„ä¸å˜
  - å¦‚éœ€è®¿é—®ç´¢å¼•å€¼ï¼Œä½¿ç”¨ `df.index.get_level_values()` æ–¹æ³•
  - `groupby+rolling` åå¿…é¡»ä½¿ç”¨ `reset_index(level=0, drop=True)` æ¢å¤ç´¢å¼•

  æ­£ç¡®ç¤ºä¾‹ï¼š
  1. è®¿é—®ç´¢å¼•å€¼ï¼š`datetime_values = df.index.get_level_values('datetime')`
  2. groupby+rollingï¼š`s = s.reset_index(level=0, drop=True)`
  3. join æ“ä½œï¼š`df = df.join(static_df, how="left")`
```

#### é—®é¢˜2ï¼š`qlib_factor_experiment_setting` åŒ…å«å¤§é‡ä¸å› å­ç¼–ç æ— å…³çš„å†…å®¹

**æ–‡ä»¶**: `rdagent/scenarios/qlib/experiment/prompts.yaml` ç¬¬180-219è¡Œ

**é—®é¢˜æè¿°**:
- ç¬¬189-202è¡Œï¼šè®¡ç®—èµ„æºä¸è®­ç»ƒè´Ÿè½½å»ºè®®ï¼ˆ12æ ¸24çº¿ç¨‹+GPUã€è®­ç»ƒè½®æ•°ã€batchå¤§å°ç­‰ï¼‰
- ç¬¬204-207è¡Œï¼šè‚¡ç¥¨æ± ç­›é€‰ä¸æ¯æ—¥æŒ‡æ ‡å› å­çš„ä¼˜å…ˆä½¿ç”¨åŸåˆ™
- ç¬¬209-219è¡Œï¼šç­–ç•¥æ¼”è¿›ä¼˜å…ˆçº§ï¼ˆå½“ IC è¿ç»­ä¸º NaN æˆ–æ”¶ç›Šæ˜¾è‘—ä¸ºè´Ÿæ—¶ï¼‰

**é—®é¢˜åˆ†æ**:
- è¿™äº›å†…å®¹å±äº**æ¨¡å‹è®­ç»ƒ**å’Œ**ç­–ç•¥æ¼”è¿›**é˜¶æ®µï¼Œè€Œéå› å­ç¼–ç é˜¶æ®µ
- å› å­ç¼–ç é˜¶æ®µåªéœ€è¦çŸ¥é“ï¼šæ•°æ®æ ¼å¼ã€ç´¢å¼•ç»“æ„ã€è¾“å‡ºæ ¼å¼
- è®­ç»ƒè½®æ•°ã€batchå¤§å°ã€å¹¶è¡Œåº¦ç­‰å‚æ•°åº”è¯¥åœ¨æ¨¡å‹ç¼–ç æç¤ºè¯ä¸­
- ç­–ç•¥æ¼”è¿›ä¼˜å…ˆçº§åº”è¯¥åœ¨åé¦ˆç”Ÿæˆæç¤ºè¯ä¸­

**å½±å“**:
- å¯¼è‡´å› å­ç¼–ç æç¤ºè¯è¿‡é•¿ï¼ˆ40è¡Œï¼‰ï¼Œåˆ†æ•£ LLM æ³¨æ„åŠ›
- LLM å¯èƒ½è¯¯ä»¥ä¸ºéœ€è¦åœ¨å› å­ä»£ç ä¸­å¤„ç†è®­ç»ƒå‚æ•°
- ä¸å› å­ç¼–ç çš„æ ¸å¿ƒç›®æ ‡ï¼ˆè®¡ç®—å› å­å€¼ï¼‰ä¸ç¬¦

**éœ€è¦ç§»åŠ¨çš„å†…å®¹**:

| å†…å®¹ | è¡Œå· | åŸä½ç½® | ç›®æ ‡ä½ç½® | æ“ä½œ |
|------|------|--------|---------|------|
| è®¡ç®—èµ„æºä¸è®­ç»ƒè´Ÿè½½å»ºè®® | 189-202 | `qlib_factor_experiment_setting` | `qlib_model_experiment_setting` | ç§»åŠ¨ |
| è‚¡ç¥¨æ± ç­›é€‰ä¸æ¯æ—¥æŒ‡æ ‡å› å­ä¼˜å…ˆä½¿ç”¨åŸåˆ™ | 204-207 | `qlib_factor_experiment_setting` | `factor_feedback_generation` æˆ–åˆ é™¤ | ç§»åŠ¨æˆ–åˆ é™¤ |
| ç­–ç•¥æ¼”è¿›ä¼˜å…ˆçº§ | 209-219 | `qlib_factor_experiment_setting` | `factor_feedback_generation` æˆ–åˆ é™¤ | ç§»åŠ¨æˆ–åˆ é™¤ |

**å»ºè®®ä¿®æ”¹**:

**æ–¹æ¡ˆ1ï¼šç²¾ç®€ `qlib_factor_experiment_setting`**ï¼ˆæ¨èï¼‰
```yaml
qlib_factor_experiment_setting: |-
  | Dataset ğŸ“Š | Data Split  ğŸ§®                                   |
  |---------|-------------------------------------------------|
  | AIstock A-share (non-ST, non-delisted) | Train: 2010-01-07 to 2018-12-31 <br> Valid: 2019-01-01 to 2020-12-31 <br> Test : 2021-01-01 to 2025-12-01 |

  **æ•°æ®è¯´æ˜**ï¼š
  - `daily_pv.h5` å·²å‰”é™¤ ST/*ST è‚¡ç¥¨å’Œé€€å¸‚è‚¡ç¥¨
  - è‚¡ç¥¨ä»£ç æ ¼å¼ç»Ÿä¸€ä¸º Qlib é£æ ¼ï¼ˆå¦‚ `000001.SZ`, `600000.SH`ï¼‰
  - **ç¦æ­¢**åœ¨å› å­è„šæœ¬ä¸­è¿›è¡Œä»»ä½•å½¢å¼çš„æ ¼å¼è½¬æ¢é€»è¾‘
```

**æ–¹æ¡ˆ2ï¼šç§»åŠ¨åˆ°æ¨¡å‹è®­ç»ƒæç¤ºè¯**
```yaml
# æ–°å¢ï¼šqlib_model_training_configï¼ˆåœ¨ qlib_model_experiment_setting ä¸­æ·»åŠ ï¼‰
qlib_model_experiment_setting: |-
  | Dataset ğŸ“Š | Model ğŸ¤–    | Factors ğŸŒŸ       | Data Split  ğŸ§®                                   |
  |---------|----------|---------------|-------------------------------------------------|
  | AIstock A-share (non-ST, non-delisted)  | ä¾‹å¦‚ GRU_TimeSeries_Model | 20 factors (Alpha158)  | Train: 2010-01-07 to 2018-12-31 <br> Valid: 2019-01-01 to 2020-12-31 <br> Test : 2021-01-01 to 2025-12-01 |

  **è®­ç»ƒé…ç½®å»ºè®®**ï¼š
  - è®­ç»ƒè½®æ•°ï¼š`n_epochs` åœ¨ 200~300
  - Batchå¤§å°ï¼šä¼˜å…ˆ 512ï¼Œæ˜¾å­˜ä¸è¶³å¯é™åˆ° 256
  - å¹¶è¡Œåº¦ï¼š`n_jobs` è®¾ç½®ä¸º 12
  - GPUï¼šPyTorch æ—¶åºæ¨¡å‹å¿…é¡»ä½¿ç”¨ `cuda:0`
```

**æ–¹æ¡ˆ3ï¼šç§»åŠ¨åˆ°åé¦ˆç”Ÿæˆæç¤ºè¯**ï¼ˆå¯é€‰ï¼‰
```yaml
# åœ¨ scenarios/qlib/prompts.yaml çš„ factor_feedback_generation ä¸­æ·»åŠ 
qlib_debugging_guidance: |-
  **è°ƒè¯•ä¼˜å…ˆçº§ï¼ˆå½“å› å­è´¨é‡å¼‚å¸¸æ—¶ï¼‰**
  1. å…ˆæ£€æŸ¥å› å­è®¡ç®—é€»è¾‘ï¼ˆæ˜¯å¦è¿‘ä¼¼å¸¸æ•°ã€æ˜¯å¦è¿‡åº¦ç¨€ç–ï¼‰
  2. æ£€æŸ¥æ•°æ®å¯¹é½ï¼ˆmerge/dropna æ˜¯å¦å¯¼è‡´æœ‰æ•ˆæ ·æœ¬å´©å¡Œï¼‰
  3. æ£€æŸ¥æ ‡ç­¾å®šä¹‰ï¼ˆé¢„æµ‹çª—å£ã€ç»å¯¹æ”¶ç›Š/è¶…é¢æ”¶ç›Šæ˜¯å¦ä¸€è‡´ï¼‰
```

---

### ğŸŸ¡ ä¸­ç­‰é—®é¢˜ï¼ˆP1ï¼‰

#### é—®é¢˜3ï¼š`qlib_factor_simulator` èƒŒæ™¯ä»‹ç»å†—ä½™

**æ–‡ä»¶**: `rdagent/scenarios/qlib/experiment/prompts.yaml` ç¬¬116-123è¡Œ

**é—®é¢˜æè¿°**:
- åŒ…å« Qlib å¹³å°çš„èƒŒæ™¯ä»‹ç»ï¼ˆ116-118è¡Œï¼‰
- åŒ…å« RDAgent å·¥ä½œæµç¨‹è¯´æ˜ï¼ˆ119-123è¡Œï¼‰
- è¿™äº›ä¿¡æ¯ä¸å› å­ç¼–ç çš„æ ¸å¿ƒä»»åŠ¡æ— å…³

**å½±å“**:
- åˆ†æ•£ LLM æ³¨æ„åŠ›
- æç¤ºè¯é•¿åº¦å¢åŠ 

**å»ºè®®ä¿®æ”¹**:
```yaml
qlib_factor_simulator: |-
  å› å­è®¡ç®—å®Œæˆåï¼Œå°†å‘é€åˆ° Qlib å¹³å°è¿›è¡Œå›æµ‹å’Œè¯„ä¼°ï¼ŒåŒ…æ‹¬ï¼š
  1. ç”Ÿæˆå› å­è¡¨
  2. è®­ç»ƒæ¨¡å‹é¢„æµ‹æœªæ¥æ”¶ç›Š
  3. æ„å»ºæŠ•èµ„ç»„åˆ
  4. è¯„ä¼°ç»„åˆè¡¨ç°ï¼ˆæ”¶ç›Šã€ICã€æœ€å¤§å›æ’¤ç­‰ï¼‰
```

#### é—®é¢˜4ï¼š`qlib_factor_rich_style_description` å’Œ `qlib_factor_from_report_rich_style_description` å†—ä½™

**æ–‡ä»¶**: `rdagent/scenarios/qlib/experiment/prompts.yaml` ç¬¬125-164è¡Œ

**é—®é¢˜æè¿°**:
- è¿™ä¸¤ä¸ªæç¤ºè¯éƒ½æ˜¯ç¤ºä¾‹æè¿°ï¼Œç”¨äºç”ŸæˆæŠ¥å‘Šçš„å¯Œæ–‡æœ¬æ ¼å¼
- åœ¨å› å­ç¼–ç é˜¶æ®µä¸éœ€è¦è¿™äº›ä¿¡æ¯

**å½±å“**:
- æç¤ºè¯æ–‡ä»¶è¿‡é•¿
- åˆ†æ•£ LLM æ³¨æ„åŠ›

**å»ºè®®**:
- å°†è¿™ä¸¤ä¸ªæç¤ºè¯ç§»åŠ¨åˆ°æŠ¥å‘Šç”Ÿæˆæ¨¡å—
- æˆ–è€…åœ¨å› å­ç¼–ç é˜¶æ®µå®Œå…¨ç§»é™¤

---

### ğŸŸ¢ ä½ä¼˜å…ˆçº§é—®é¢˜ï¼ˆP2ï¼‰

#### é—®é¢˜5ï¼š`transformer_volume_price_strategy` ç¤ºä¾‹ç­–ç•¥ä¸å¿…è¦

**æ–‡ä»¶**: `rdagent/scenarios/qlib/experiment/prompts.yaml` ç¬¬319-332è¡Œ

**é—®é¢˜æè¿°**:
- è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ç­–ç•¥æè¿°ï¼Œæ˜ç¡®è¯´æ˜"ä¸å¯¹å½“å‰ä»»åŠ¡æˆ–ä»»ä½•å…·ä½“å®éªŒæ„æˆç¡¬æ€§çº¦æŸ"
- åœ¨å› å­ç¼–ç é˜¶æ®µä¸éœ€è¦äº†è§£ç­–ç•¥ç»†èŠ‚

**å½±å“**:
- æç¤ºè¯æ–‡ä»¶è¿‡é•¿
- å¯èƒ½è¯¯å¯¼ LLM ä»¥ä¸ºéœ€è¦å®ç°ç‰¹å®šç­–ç•¥

**å»ºè®®**:
- åˆ é™¤æ­¤æç¤ºè¯
- æˆ–ç§»åŠ¨åˆ°ç­–ç•¥è®¾è®¡æ¨¡å—ï¼ˆå¦‚æœéœ€è¦ï¼‰

---

#### é—®é¢˜6ï¼šå› å­å®¡æ ¸æç¤ºè¯çš„ä½¿ç”¨é˜¶æ®µ

**æ–‡ä»¶**: `rdagent/components/coder/factor_coder/prompts.yaml`

**æç¤ºè¯åˆ—è¡¨**:
- `evaluator_code_feedback_v1_system` - ä»£ç è¯„ä¼°ï¼ˆæ£€æŸ¥ä»£ç æ˜¯å¦ä¸å› å­å’Œåœºæ™¯å¯¹é½ï¼‰
- `evaluator_code_feedback_v1_user` - ç”¨æˆ·è¾“å…¥
- `evolving_strategy_error_summary_v2_system` - é”™è¯¯æ€»ç»“
- `select_implementable_factor_system` - å› å­é€‰æ‹©
- `evaluator_output_format_system` - è¾“å‡ºæ ¼å¼æ£€æŸ¥
- `evaluator_final_decision_v1_system` - æœ€ç»ˆå†³ç­–

**ä½¿ç”¨é˜¶æ®µ**: å› å­ç ”å‘é˜¶æ®µ

**å½±å“èŒƒå›´**: ä¿®æ”¹è¿™äº›æç¤ºè¯ä¼šå½±å“å› å­ç ”å‘è¿‡ç¨‹

**å»ºè®®**:
- è¿™äº›æç¤ºè¯å±äºå› å­ç ”å‘é˜¶æ®µï¼Œæœ¬æ¬¡ä¼˜åŒ–æš‚ä¸ä¿®æ”¹
- å¦‚æœéœ€è¦ä¼˜åŒ–ï¼Œåº”è¯¥å•ç‹¬åˆ†æ

---

## ä¸‰ã€éœ€è¦ç§»åŠ¨åˆ°å…¶ä»–æ¨¡å—çš„å†…å®¹æ±‡æ€»

### 3.1 ç§»åŠ¨åˆ°æ¨¡å‹è®­ç»ƒæç¤ºè¯

| å†…å®¹ | åŸä½ç½® | è¡Œå· | ç›®æ ‡ä½ç½® | æ“ä½œ |
|------|--------|------|---------|------|
| è®¡ç®—èµ„æºä¸è®­ç»ƒè´Ÿè½½å»ºè®® | `qlib_factor_experiment_setting` | 189-202 | `qlib_model_experiment_setting` | ç§»åŠ¨å¹¶ç®€åŒ– |

**ç§»åŠ¨åçš„å†…å®¹**ï¼ˆç®€åŒ–ç‰ˆï¼‰:
```yaml
qlib_model_experiment_setting: |-
  | Dataset ğŸ“Š | Model ğŸ¤–    | Factors ğŸŒŸ       | Data Split  ğŸ§®                                   |
  |---------|----------|---------------|-------------------------------------------------|
  | AIstock A-share (non-ST, non-delisted)  | ä¾‹å¦‚ GRU_TimeSeries_Model | 20 factors (Alpha158)  | Train: 2010-01-07 to 2018-12-31 <br> Valid: 2019-01-01 to 2020-12-31 <br> Test : 2021-01-01 to 2025-12-01 |

  **è®­ç»ƒé…ç½®å»ºè®®**ï¼š
  - è®­ç»ƒè½®æ•°ï¼š`n_epochs` åœ¨ 200~300
  - Batchå¤§å°ï¼šä¼˜å…ˆ 512ï¼Œæ˜¾å­˜ä¸è¶³å¯é™åˆ° 256
  - å¹¶è¡Œåº¦ï¼š`n_jobs` è®¾ç½®ä¸º 12
  - GPUï¼šPyTorch æ—¶åºæ¨¡å‹å¿…é¡»ä½¿ç”¨ `cuda:0`
```

### 3.2 ç§»åŠ¨åˆ°åé¦ˆç”Ÿæˆæç¤ºè¯æˆ–åˆ é™¤

| å†…å®¹ | åŸä½ç½® | è¡Œå· | ç›®æ ‡ä½ç½® | æ“ä½œ |
|------|--------|------|---------|------|
| è‚¡ç¥¨æ± ç­›é€‰ä¸æ¯æ—¥æŒ‡æ ‡å› å­ä¼˜å…ˆä½¿ç”¨åŸåˆ™ | `qlib_factor_experiment_setting` | 204-207 | `factor_feedback_generation` æˆ–åˆ é™¤ | ç§»åŠ¨æˆ–åˆ é™¤ |
| ç­–ç•¥æ¼”è¿›ä¼˜å…ˆçº§ | `qlib_factor_experiment_setting` | 209-219 | `factor_feedback_generation` æˆ–åˆ é™¤ | ç§»åŠ¨æˆ–åˆ é™¤ |

**å»ºè®®**: å¦‚æœæ•°æ®é›†å·²ç»ç¨³å®šï¼Œå¯ä»¥åˆ é™¤è¿™äº›å†…å®¹ï¼›å¦‚æœéœ€è¦ä¿ç•™ï¼Œç®€åŒ–åç§»åŠ¨åˆ°åé¦ˆç”Ÿæˆæç¤ºè¯ã€‚

**ç®€åŒ–ç‰ˆæœ¬**ï¼ˆå¦‚æœä¿ç•™ï¼‰:
```yaml
qlib_debugging_guidance: |-
  **è°ƒè¯•ä¼˜å…ˆçº§ï¼ˆå½“å› å­è´¨é‡å¼‚å¸¸æ—¶ï¼‰**
  1. å…ˆæ£€æŸ¥å› å­è®¡ç®—é€»è¾‘ï¼ˆæ˜¯å¦è¿‘ä¼¼å¸¸æ•°ã€æ˜¯å¦è¿‡åº¦ç¨€ç–ï¼‰
  2. æ£€æŸ¥æ•°æ®å¯¹é½ï¼ˆmerge/dropna æ˜¯å¦å¯¼è‡´æœ‰æ•ˆæ ·æœ¬å´©å¡Œï¼‰
  3. æ£€æŸ¥æ ‡ç­¾å®šä¹‰ï¼ˆé¢„æµ‹çª—å£ã€ç»å¯¹æ”¶ç›Š/è¶…é¢æ”¶ç›Šæ˜¯å¦ä¸€è‡´ï¼‰
```

---

## å››ã€ä¿®æ”¹ä¼˜å…ˆçº§å»ºè®®

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“èŒƒå›´ | é¢„æœŸæ•ˆæœ |
|--------|------|----------|----------|
| **P0** | `qlib_factor_strategy` é”™è¯¯å¼•å¯¼ | å› å­ç¼–ç é˜¶æ®µ | **å‡å°‘ç´¢å¼•é”™è¯¯ï¼Œæå‡ç¼–ç æˆåŠŸç‡** |
| **P0** | `qlib_factor_experiment_setting` å†…å®¹å†—ä½™ | å› å­ç¼–ç é˜¶æ®µ | **ç¼©çŸ­æç¤ºè¯ï¼Œæå‡èšç„¦åº¦** |
| **P1** | `qlib_factor_simulator` èƒŒæ™¯ä»‹ç»å†—ä½™ | å› å­ç¼–ç é˜¶æ®µ | ç¼©çŸ­æç¤ºè¯é•¿åº¦ |
| **P1** | rich_style_description å†—ä½™ | å› å­ç¼–ç é˜¶æ®µ | ç¼©çŸ­æç¤ºè¯é•¿åº¦ |
| **P2** | `transformer_volume_price_strategy` ä¸å¿…è¦ | å› å­ç¼–ç é˜¶æ®µ | å‡å°‘è¯¯å¯¼ |
| **P2** | `evolving_strategy_factor_implementation_v1_system` è¯­è¨€æ··ç”¨ | å› å­ç¼–ç é˜¶æ®µ | ç»Ÿä¸€è¾“å‡ºè¯­è¨€ |

---

## äº”ã€å»ºè®®çš„æ–‡ä»¶ç»“æ„ï¼ˆä¼˜åŒ–åï¼‰

```
rdagent/scenarios/qlib/experiment/
â”œâ”€â”€ prompts.yaml                              # ä¸»æ–‡ä»¶ï¼ˆç²¾ç®€åï¼‰
â”‚   â”œâ”€â”€ qlib_factor_interface                 # å·²æ¨¡å—åŒ– âœ“
â”‚   â”œâ”€â”€ qlib_factor_strategy                  # éœ€ä¿®å¤é”™è¯¯å¼•å¯¼
â”‚   â”œâ”€â”€ qlib_factor_experiment_setting        # éœ€ç²¾ç®€
â”‚   â”œâ”€â”€ qlib_factor_output_format             # ä¿ç•™
â”‚   â”œâ”€â”€ qlib_model_interface                  # ä¿ç•™
â”‚   â”œâ”€â”€ qlib_model_experiment_setting         # éœ€æ–°å¢
â”‚   â””â”€â”€ qlib_strategy_evolution_guidance      # éœ€æ–°å¢
â”œâ”€â”€ prompts_core_constraints.yaml             # âœ“ å·²åˆ›å»º
â”œâ”€â”€ prompts_data_loading.yaml                 # âœ“ å·²åˆ›å»º
â”œâ”€â”€ prompts_error_prevention.yaml             # âœ“ å·²åˆ›å»º
â”œâ”€â”€ prompts_dataset_info.yaml                 # âœ“ å·²åˆ›å»º
â”œâ”€â”€ prompts_language_spec.yaml                # âœ“ å·²åˆ›å»º
â””â”€â”€ prompts.yaml.backup_20260109              # âœ“ å¤‡ä»½
```

---

## å…­ã€æ€»ç»“

### å·²å®Œæˆä¼˜åŒ–
- âœ… `qlib_factor_interface` å·²æ¨¡å—åŒ–ï¼Œä¿¡æ¯è¿‡è½½é—®é¢˜è§£å†³
- âœ… æ–°å¢é”™è¯¯é¢„é˜²æ¨¡å—ï¼ŒåŒ…å«5ä¸ªå¸¸è§é”™è¯¯æ¡ˆä¾‹

### ä»éœ€ä¼˜åŒ–
- ğŸ”´ **P0**: `qlib_factor_strategy` é”™è¯¯å¼•å¯¼ï¼ˆreset_indexç¤ºä¾‹ï¼‰
- ğŸ”´ **P0**: `qlib_factor_experiment_setting` å†…å®¹å†—ä½™ï¼ˆè®­ç»ƒå‚æ•°ã€ç­–ç•¥æ¼”è¿›ï¼‰
- ğŸŸ¡ **P1**: èƒŒæ™¯ä»‹ç»å’Œç¤ºä¾‹æè¿°å†—ä½™
- ğŸŸ¢ **P2**: è¯­è¨€æ··ç”¨é—®é¢˜

### é¢„æœŸæ•ˆæœ
ä¿®å¤ P0 é—®é¢˜åï¼Œé¢„è®¡ï¼š
- å‡å°‘ç´¢å¼•ç»“æ„é”™è¯¯ï¼ˆreset_indexã€droplevelç­‰ï¼‰
- æå‡å› å­ç¼–ç æˆåŠŸç‡ 10-15%
- å‡å°‘ coding è¿­ä»£è½®æ•° 1-2è½®

---

## ä¿®æ”¹è®°å½•

### ä¿®æ”¹è®°å½• - 2026-01-10

**ä¿®æ”¹äºº**: Cascade
**ä¿®æ”¹æ—¶é—´**: 2026-01-10 15:00:00
**ä¿®æ”¹åŸå› **: ç²¾ç®€å› å­ç ”å‘é˜¶æ®µæç¤ºè¯ï¼Œç§»é™¤å†—ä½™å†…å®¹ï¼Œä¿®å¤é”™è¯¯å¼•å¯¼

#### å¤‡ä»½ä¿¡æ¯

| æ–‡ä»¶ | å¤‡ä»½æ–‡ä»¶ | å¤‡ä»½æ—¶é—´ |
|------|---------|---------|
| `rdagent/scenarios/qlib/experiment/prompts.yaml` | `prompts.yaml.backup_20260109` | 2026-01-09 |
| `rdagent/components/coder/factor_coder/prompts.yaml` | `prompts.yaml.backup_20260110` | 2026-01-10 |

#### ä¿®æ”¹å†…å®¹

| æç¤ºè¯é”®å | ä¿®æ”¹å‰ | ä¿®æ”¹å | å½±å“èŒƒå›´ |
|-----------|--------|--------|---------|
| `qlib_factor_strategy` | åŒ…å«é”™è¯¯çš„ `reset_index()` ç¤ºä¾‹ä»£ç  | æ˜ç¡® `reset_index()` ä½¿ç”¨è§„åˆ™ï¼Œç¦æ­¢ç ´åæ€§æ“ä½œï¼Œå…è®¸å¿…è¦çš„æ¢å¤æ“ä½œ | å› å­ç ”å‘é˜¶æ®µ |
| `qlib_factor_experiment_setting` | 40è¡Œï¼ŒåŒ…å«è®­ç»ƒå‚æ•°ã€è‚¡ç¥¨æ± ç­›é€‰ã€ç­–ç•¥æ¼”è¿› | 8è¡Œï¼Œåªä¿ç•™æ•°æ®é›†ä¿¡æ¯å’Œè‚¡ç¥¨ä»£ç æ ¼å¼è¯´æ˜ | å› å­ç ”å‘é˜¶æ®µ |
| `qlib_model_experiment_setting` | åŒ…å«é‡å¤çš„è‚¡ç¥¨ä»£ç æ ¼å¼è¯´æ˜ | åˆ é™¤é‡å¤çš„è‚¡ç¥¨ä»£ç æ ¼å¼è¯´æ˜ | æ¨¡å‹è®­ç»ƒé˜¶æ®µ |
| `evolving_strategy_factor_implementation_v1_system` | 6è¡Œè‚¡ç¥¨ä»£ç æ ¼å¼è¯´æ˜ï¼ˆåŒ…å«STè‚¡ç¥¨è¿‡æ»¤ç­‰ï¼‰ | 3è¡Œï¼Œåªä¿ç•™æ ¸å¿ƒæ ¼å¼çº¦å®š | å› å­å®¡æ ¸é˜¶æ®µ |
| `transformer_volume_price_strategy` | 15è¡Œç¤ºä¾‹ç­–ç•¥æè¿° | åˆ é™¤æ•´ä¸ªæç¤ºè¯ | å› å­ç ”å‘é˜¶æ®µ |

#### æ¢å¤æ–¹æ³•

```bash
# æ¢å¤å› å­ç ”å‘é˜¶æ®µæç¤ºè¯
cp rdagent/scenarios/qlib/experiment/prompts.yaml.backup_20260109 rdagent/scenarios/qlib/experiment/prompts.yaml

# æ¢å¤å› å­å®¡æ ¸é˜¶æ®µæç¤ºè¯
cp rdagent/components/coder/factor_coder/prompts.yaml.backup_20260110 rdagent/components/coder/factor_coder/prompts.yaml
```

#### éªŒè¯æ–¹æ³•

1. æ£€æŸ¥ `prompts.yaml` æ–‡ä»¶æ˜¯å¦å¯ä»¥æ­£å¸¸åŠ è½½ï¼ˆYAML æ ¼å¼æ­£ç¡®ï¼‰
2. æ£€æŸ¥ Jinja2 include è¯­æ³•æ˜¯å¦æ­£ç¡®
3. è¿è¡Œä¸€ä¸ªç®€å•çš„å› å­ç¼–ç ä»»åŠ¡ï¼ŒéªŒè¯æç¤ºè¯æ˜¯å¦ç”Ÿæ•ˆ
4. æ£€æŸ¥ç”Ÿæˆçš„å› å­ä»£ç æ˜¯å¦ç¬¦åˆæ–°çš„çº¦æŸï¼ˆç‰¹åˆ«æ˜¯ `reset_index()` ä½¿ç”¨è§„åˆ™ï¼‰

#### ä¿®æ”¹æ•ˆæœ

- `qlib_factor_experiment_setting` ä» 40 è¡Œå‡å°‘åˆ° 8 è¡Œï¼ˆå‡å°‘ 80%ï¼‰
- åˆ é™¤äº† 15 è¡Œçš„ç¤ºä¾‹ç­–ç•¥æè¿°
- ç»Ÿä¸€äº†è‚¡ç¥¨ä»£ç æ ¼å¼è¯´æ˜ï¼Œå‡å°‘é‡å¤
- ä¿®å¤äº† `reset_index()` é”™è¯¯å¼•å¯¼ï¼Œæ˜ç¡®äº†ä½¿ç”¨è§„åˆ™
- ä¸å½±å“å› å­å®¡æ ¸æç¤ºè¯çš„å…¶ä»–å†…å®¹

---

### ä¿®æ”¹è®°å½• - 2026-01-10ï¼ˆä¸‹åˆï¼‰

**ä¿®æ”¹äºº**: Cascade
**ä¿®æ”¹æ—¶é—´**: 2026-01-10 15:30:00
**ä¿®æ”¹åŸå› **: åˆ é™¤æç¤ºè¯ä¸­å…³äº $ å‰ç¼€å­—æ®µåçš„è¯´æ˜ï¼Œç»Ÿä¸€ä½¿ç”¨ä¸å¸¦ $ çš„å­—æ®µå‘½åè§„åˆ™

#### å¤‡ä»½ä¿¡æ¯

| æ–‡ä»¶ | å¤‡ä»½æ–‡ä»¶ | å¤‡ä»½æ—¶é—´ |
|------|---------|---------|
| `rdagent/scenarios/qlib/experiment/prompts.yaml` | `prompts.yaml.backup_20260109` | 2026-01-09 |
| `rdagent/components/coder/factor_coder/prompts.yaml` | `prompts.yaml.backup_20260110` | 2026-01-10 |
| `rdagent/scenarios/qlib/experiment/prompts_core_constraints.yaml` | `prompts_core_constraints.yaml.backup_20260110` | 2026-01-10 |
| `rdagent/scenarios/qlib/experiment/prompts_data_loading.yaml` | `prompts_data_loading.yaml.backup_20260110` | 2026-01-10 |
| `rdagent/scenarios/qlib/experiment/prompts_error_prevention.yaml` | `prompts_error_prevention.yaml.backup_20260110` | 2026-01-10 |

#### ä¿®æ”¹å†…å®¹

| æ–‡ä»¶ | ä¿®æ”¹å‰ | ä¿®æ”¹å | å½±å“èŒƒå›´ |
|------|--------|--------|---------|
| `prompts_core_constraints.yaml` | æ¨¡æ¿ä¸­åŒ…å« `$open` â†’ `open` ç­‰å­—æ®µé‡å‘½åé€»è¾‘ | åˆ é™¤é‡å‘½åé€»è¾‘ï¼Œç›´æ¥ä½¿ç”¨ä¸å¸¦ $ çš„å­—æ®µå | å› å­ç ”å‘é˜¶æ®µ |
| `prompts_data_loading.yaml` | è¯´æ˜ `$open`, `$high` ç­‰ Qlib é£æ ¼å­—æ®µåï¼Œè¦æ±‚é‡å‘½å | è¯´æ˜ `open`, `high` ç­‰å­—æ®µåï¼Œæ— éœ€é‡å‘½å | å› å­ç ”å‘é˜¶æ®µ |
| `prompts_error_prevention.yaml` | é”™è¯¯2ï¼šæ··ç”¨ `$close` å’Œ `close` | é”™è¯¯2ï¼šä½¿ç”¨ä¸å­˜åœ¨çš„å­—æ®µå | å› å­ç ”å‘é˜¶æ®µ |

#### ä¿®æ”¹åŸå› 

1. **å®é™…æ•°æ®æ ¼å¼**ï¼šå½“å‰çš„ `daily_pv.h5` æ–‡ä»¶å·²ç»ç»Ÿä¸€æˆä¸å¸¦ `$` ç¬¦çš„æ ¼å¼
2. **è¯¯å¯¼æ€§è¯´æ˜**ï¼šåŸæç¤ºè¯ä¸­å…³äº `$` å‰ç¼€çš„è¯´æ˜ä¸å®é™…æ•°æ®æ ¼å¼ä¸ç¬¦ï¼Œå®¹æ˜“é€ æˆæ··æ·†
3. **ç®€åŒ–é€»è¾‘**ï¼šQlib çš„ bin æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰ `$` çš„æ ¼å¼ï¼Œåªæ˜¯å­—æ®µä½¿ç”¨æ—¶çš„å®šä¹‰ï¼Œå…¨å±€çº¦å®šå­—æ®µåç§°å³å¯

#### æ¢å¤æ–¹æ³•

```bash
# æ¢å¤æ‰€æœ‰ä¿®æ”¹çš„æ¨¡å—æ–‡ä»¶
cp rdagent/scenarios/qlib/experiment/prompts_core_constraints.yaml.backup_20260110 rdagent/scenarios/qlib/experiment/prompts_core_constraints.yaml
cp rdagent/scenarios/qlib/experiment/prompts_data_loading.yaml.backup_20260110 rdagent/scenarios/qlib/experiment/prompts_data_loading.yaml
cp rdagent/scenarios/qlib/experiment/prompts_error_prevention.yaml.backup_20260110 rdagent/scenarios/qlib/experiment/prompts_error_prevention.yaml
```

#### éªŒè¯æ–¹æ³•

1. æ£€æŸ¥æ‰€æœ‰æ¨¡å—æ–‡ä»¶ä¸­æ˜¯å¦è¿˜å­˜åœ¨ `$` å‰ç¼€çš„å­—æ®µåå¼•ç”¨
2. è¿è¡Œä¸€ä¸ªç®€å•çš„å› å­ç¼–ç ä»»åŠ¡ï¼ŒéªŒè¯å­—æ®µåå¯ä»¥ç›´æ¥ä½¿ç”¨
3. æ£€æŸ¥ç”Ÿæˆçš„å› å­ä»£ç æ˜¯å¦åŒ…å«ä¸å¿…è¦çš„é‡å‘½åé€»è¾‘

#### ä¿®æ”¹æ•ˆæœ

- åˆ é™¤äº†çº¦ 15 è¡Œå…³äº `$` å‰ç¼€çš„è¯´æ˜å’Œé‡å‘½åä»£ç 
- ç®€åŒ–äº†å› å­è„šæœ¬æ¨¡æ¿ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„æ­¥éª¤
- æ¶ˆé™¤äº†æ•°æ®æ ¼å¼è¯´æ˜ä¸å®é™…æ•°æ®çš„ä¸ä¸€è‡´
- æå‡äº†æç¤ºè¯çš„å‡†ç¡®æ€§å’Œå¯è¯»æ€§

#### é£é™©è¯„ä¼°

- **ä½é£é™©**ï¼šæ­¤ä¿®æ”¹åªæ˜¯åˆ é™¤äº†è¯¯å¯¼æ€§çš„è¯´æ˜ï¼Œå®é™…æ•°æ®æ ¼å¼å·²ç»æ˜¯ä¸å¸¦ `$` çš„
- **å¯å›æ»š**ï¼šæ‰€æœ‰ä¿®æ”¹çš„æ–‡ä»¶éƒ½æœ‰å¤‡ä»½ï¼Œå¯ä»¥ä¸€é”®æ¢å¤
- **å…¼å®¹æ€§**ï¼šä¸å½±å“ç°æœ‰çš„å› å­ä»£ç ï¼Œå› ä¸ºå®é™…æ•°æ®æ ¼å¼å·²ç»ç»Ÿä¸€
