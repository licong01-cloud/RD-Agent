# RDAgent æç¤ºè¯åˆ†ææŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-09  
**åˆ†æèŒƒå›´**: RDAgent æ‰€æœ‰ prompts.yaml æ–‡ä»¶  
**ç›®çš„**: è¯†åˆ«æç¤ºè¯ä¸­çš„é”™è¯¯å¼•å¯¼ã€ä¸å¿…è¦å†…å®¹ï¼Œå¹¶æå‡ºä¼˜åŒ–å»ºè®®

---

## ä¸€ã€æ‰«æèŒƒå›´æ¦‚è§ˆ

å·²æ‰«æä»¥ä¸‹æç¤ºè¯æ–‡ä»¶ï¼ˆå…±12ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼‰ï¼š

| æ–‡ä»¶è·¯å¾„ | ä¸»è¦åŠŸèƒ½ | è¡Œæ•° |
|----------|----------|------|
| `rdagent/components/coder/factor_coder/prompts.yaml` | å› å­ç¼–ç  | 217 |
| `rdagent/components/coder/model_coder/prompts.yaml` | æ¨¡å‹ç¼–ç  | 156 |
| `rdagent/components/coder/CoSTEER/prompts.yaml` | CoSTEERç»„ä»¶åˆ†æ | 10 |
| `rdagent/scenarios/qlib/experiment/prompts.yaml` | Qlibå®éªŒåœºæ™¯ | 464 |
| `rdagent/scenarios/qlib/prompts.yaml` | Qlibåœºæ™¯ | 375 |
| `rdagent/components/proposal/prompts.yaml` | ææ¡ˆç”Ÿæˆ | 65 |
| `rdagent/app/qlib_rd_loop/prompts.yaml` | Qlib RD Loop | 15 |
| `rdagent/components/agent/context7/prompts.yaml` | Context7é”™è¯¯æŸ¥è¯¢ | 60 |
| `rdagent/utils/prompts.yaml` | å·¥å…·ç±» | 21 |
| `rdagent/components/coder/data_science/share/prompts.yaml` | æ•°æ®ç§‘å­¦å…±äº« | 124 |
| `rdagent/components/coder/data_science/model/prompts.yaml` | æ•°æ®ç§‘å­¦æ¨¡å‹ | 187 |
| `rdagent/components/coder/data_science/feature/prompts.yaml` | æ•°æ®ç§‘å­¦ç‰¹å¾ | 132 |

---

## äºŒã€æ ¸å¿ƒé—®é¢˜åˆ†æ

### é—®é¢˜1ï¼šä¿¡æ¯è¿‡è½½ï¼ˆä¸¥é‡åº¦ï¼šé«˜ï¼‰

#### é—®é¢˜æè¿°
æç¤ºè¯è¿‡é•¿ï¼Œå…³é”®çº¦æŸè¢«å¤§é‡èƒŒæ™¯ä¿¡æ¯æ·¹æ²¡ï¼ŒLLMéš¾ä»¥èšç„¦æ ¸å¿ƒè¦æ±‚ã€‚

#### å…·ä½“æ¡ˆä¾‹

**æ¡ˆä¾‹1ï¼š`qlib_factor_interface`ï¼ˆ464è¡Œï¼‰**
```yaml
# ç¬¬42-182è¡Œï¼Œé•¿è¾¾140è¡Œçš„å› å­æ¥å£è¯´æ˜
qlib_factor_interface: |-
  Your python code should follow the interface to better interact with the user's system.
  Your python code should contain the following part: the import part, the function part, and the main part.
  # ... å¤§é‡èƒŒæ™¯è¯´æ˜ ...
  
  ã€ç»Ÿä¸€å› å­è„šæœ¬æ¨¡æ¿ï¼ˆå¿…é¡»éµå®ˆï¼ŒLLM åªèƒ½åœ¨ä¸­é—´åŒºåŸŸå†™é€»è¾‘ï¼‰ã€‘
  # ... 53è¡Œæ¨¡æ¿ä»£ç  ...
  
  ã€æ•°æ®åŠ è½½ä¸å­—æ®µåè§„èŒƒï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼Œç”¨äºé¿å… $close / close åˆ—åé”™è¯¯ï¼‰ã€‘
  # ... 35è¡Œè§„èŒƒè¯´æ˜ ...
  
  ã€ä¸¥ç¦ç¡¬ç¼–ç æ›¿ä»£å˜é‡ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ã€‘
  # ... 14è¡Œçº¦æŸè¯´æ˜ ...
```

**é—®é¢˜**ï¼š
- æ ¸å¿ƒçº¦æŸï¼ˆMultiIndexç´¢å¼•ã€åˆ—åé‡å‘½åã€è¾“å‡ºæ ¼å¼ï¼‰åˆ†æ•£åœ¨140è¡Œä¸­
- LLMå¯èƒ½å¿½ç•¥å…³é”®çš„"å¿…é¡»éµå®ˆ"çº¦æŸ
- ç¤ºä¾‹ä»£ç è¿‡é•¿ï¼Œåˆ†æ•£æ³¨æ„åŠ›

**æ¡ˆä¾‹2ï¼š`qlib_factor_experiment_setting`ï¼ˆç¬¬311-350è¡Œï¼‰**
```yaml
qlib_factor_experiment_setting: |-
  | Dataset ğŸ“Š | Model ğŸ¤–    | Factors ğŸŒŸ       | Data Split  ğŸ§®                                   |
  |---------|----------|---------------|-------------------------------------------------|
  | AIstock A-share (non-ST, non-delisted)  | GRU_TimeSeries_Model | Alpha158 Plus + AIstock factors | ... |
  
  **é‡è¦è¯´æ˜ï¼šè‚¡ç¥¨ä»£ç æ ¼å¼**
  - è™½ç„¶æ•°æ®é›†åç§°ä¸º "AIstock A-share"ï¼Œä½†æ‰€æœ‰åŸå§‹ HDF5/Parquet æ•°æ®ä¸­çš„ `instrument` å‡å·²ç»Ÿä¸€ä¸º **Qlib é£æ ¼**ï¼ˆå¦‚ `000001.SZ`, `600000.SH`ï¼‰ã€‚
  - **ç¦æ­¢**åœ¨å› å­è„šæœ¬ä¸­è¿›è¡Œä»»ä½•å½¢å¼çš„æ ¼å¼è½¬æ¢é€»è¾‘.
  
  #### è®¡ç®—èµ„æºä¸è®­ç»ƒè´Ÿè½½å»ºè®®ï¼ˆè¯·ä¼˜å…ˆæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼Œä»¥å……åˆ†åˆ©ç”¨æœ¬æœº 12 æ ¸ 24 çº¿ç¨‹ + GPUï¼‰
  # ... 24è¡Œç¡¬ä»¶é…ç½®å»ºè®® ...
  
  #### è‚¡ç¥¨æ± ç­›é€‰ä¸æ¯æ—¥æŒ‡æ ‡å› å­çš„ä¼˜å…ˆä½¿ç”¨åŸåˆ™
  # ... 15è¡ŒåŸåˆ™è¯´æ˜ ...
  
  #### ç­–ç•¥æ¼”è¿›ä¼˜å…ˆçº§ï¼ˆå½“ IC è¿ç»­ä¸º NaN æˆ–æ”¶ç›Šæ˜¾è‘—ä¸ºè´Ÿæ—¶ï¼‰
  # ... 11è¡Œæ¼”è¿›ç­–ç•¥ ...
```

**é—®é¢˜**ï¼š
- åŒ…å«å¤§é‡ä¸å› å­ç¼–ç æ— å…³çš„ä¿¡æ¯ï¼ˆæ¨¡å‹è®­ç»ƒã€ç¡¬ä»¶é…ç½®ã€ç­–ç•¥æ¼”è¿›ï¼‰
- è¿™äº›ä¿¡æ¯åº”è¯¥åœ¨æ¨¡å‹ç¼–ç æç¤ºè¯ä¸­ï¼Œè€Œä¸æ˜¯å› å­ç¼–ç æç¤ºè¯ä¸­
- å¯¼è‡´å› å­ç¼–ç æç¤ºè¯è¿‡é•¿ï¼Œåˆ†æ•£LLMæ³¨æ„åŠ›

#### å»ºè®®ä¿®æ”¹

**æ–¹æ¡ˆ1ï¼šæ‹†åˆ†æç¤ºè¯ï¼ˆæ¨èï¼‰**

ä½¿ç”¨YAMLçš„includeæœºåˆ¶ï¼Œå°†æ ¸å¿ƒçº¦æŸæ‹†åˆ†ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼š

```yaml
# æ–°å»ºï¼šfactor_coder_core_constraints.yaml
factor_coder_core_constraints: |-
  ã€æ ¸å¿ƒçº¦æŸï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ã€‘
  1. ç´¢å¼•ç»“æ„ï¼šå§‹ç»ˆä¿æŒMultiIndex(datetime, instrument)
  2. åˆ—åè§„èŒƒï¼šå¿…é¡»å…ˆç»Ÿä¸€é‡å‘½åï¼Œåç»­åªä½¿ç”¨é‡å‘½ååçš„å­—æ®µ
  3. è¾“å‡ºæ ¼å¼ï¼šresult_df = pd.DataFrame(index=df.index), åˆ—åä¸ºå› å­åï¼Œç±»å‹ä¸ºfloat32
  4. groupby+rollingåå¿…é¡»ï¼šs = s.reset_index(level=0, drop=True)
  5. ç¦æ­¢ï¼šreset_index(drop=True)ã€droplevelã€swaplevelç­‰æ”¹å˜ç´¢å¼•ç»“æ„çš„æ“ä½œ

# æ–°å»ºï¼šfactor_coder_error_prevention.yaml
factor_coder_error_prevention: |-
  ã€å¸¸è§é”™è¯¯é¢„é˜²ã€‘
  é”™è¯¯1ï¼šgroupby+rollingç´¢å¼•ä¸å¯¹é½
    é—®é¢˜ï¼šgroupby+rollingåç´¢å¼•å˜æˆ(datetime, instrument, level_2)
    è§£å†³ï¼šs = s.reset_index(level=0, drop=True)
  
  é”™è¯¯2ï¼šåˆ—åæ··æ·†
    é—®é¢˜ï¼šæ··ç”¨$closeå’Œclose
    è§£å†³ï¼šå¿…é¡»å…ˆç»Ÿä¸€é‡å‘½åï¼Œåç»­åªä½¿ç”¨é‡å‘½ååçš„å­—æ®µ
  
  é”™è¯¯3ï¼šè¾“å‡ºæ ¼å¼é”™è¯¯
    é—®é¢˜ï¼šç´¢å¼•åç§°ä¸¢å¤±
    è§£å†³ï¼šresult_df.index.names = df.index.names

# æ–°å»ºï¼šfactor_coder_examples.yaml
factor_coder_examples: |-
  ã€å®Œæ•´ç¤ºä¾‹ã€‘
  ç¤ºä¾‹1ï¼šç®€å•åŠ¨é‡å› å­
  ç¤ºä¾‹2ï¼šä½¿ç”¨groupby+rolling
  ç¤ºä¾‹3ï¼šä½¿ç”¨static_factors.parquet
  ç¤ºä¾‹4ï¼šå¤šåˆ—groupby+rolling

# åŸæç¤ºè¯ç²¾ç®€ä¸ºï¼š
qlib_factor_interface: |-
  {% include "factor_coder_core_constraints" %}
  {% include "factor_coder_error_prevention" %}
  {% include "factor_coder_examples" %}
```

**æ–¹æ¡ˆ2ï¼šå•æ–‡ä»¶å†…éƒ¨ç»“æ„åŒ–**

å¦‚æœä¸æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼Œå¯ä»¥åœ¨å•æ–‡ä»¶ä¸­ä½¿ç”¨æ›´æ¸…æ™°çš„ç»“æ„ï¼š

```yaml
qlib_factor_interface: |-
  ============ æ ¸å¿ƒçº¦æŸï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰ ============
  1. ç´¢å¼•ç»“æ„ï¼šå§‹ç»ˆä¿æŒMultiIndex(datetime, instrument)
  2. åˆ—åè§„èŒƒï¼šå¿…é¡»å…ˆç»Ÿä¸€é‡å‘½åï¼Œåç»­åªä½¿ç”¨é‡å‘½ååçš„å­—æ®µ
  3. è¾“å‡ºæ ¼å¼ï¼šresult_df = pd.DataFrame(index=df.index), åˆ—åä¸ºå› å­åï¼Œç±»å‹ä¸ºfloat32
  4. groupby+rollingåå¿…é¡»ï¼šs = s.reset_index(level=0, drop=True)
  
  ============ å¸¸è§é”™è¯¯é¢„é˜² ============
  [é”™è¯¯1] groupby+rollingç´¢å¼•ä¸å¯¹é½
    é—®é¢˜ï¼šgroupby+rollingåç´¢å¼•å˜æˆ(datetime, instrument, level_2)
    è§£å†³ï¼šs = s.reset_index(level=0, drop=True)
  
  [é”™è¯¯2] åˆ—åæ··æ·†
    é—®é¢˜ï¼šæ··ç”¨$closeå’Œclose
    è§£å†³ï¼šå¿…é¡»å…ˆç»Ÿä¸€é‡å‘½åï¼Œåç»­åªä½¿ç”¨é‡å‘½ååçš„å­—æ®µ
  
  ============ ä»£ç æ¨¡æ¿ ============
  ```python
  def calculate_factor():
      df = pd.read_hdf("daily_pv.h5", key="data").sort_index()
      # é‡å‘½å
      rename_map = {"$open": "open", "$close": "close", ...}
      df = df.rename(columns=rename_map)
      
      # å› å­è®¡ç®—ï¼ˆåœ¨æ­¤åŒºåŸŸç¼–å†™ä»£ç ï¼‰
      series = df["close"].groupby(level="instrument").rolling(10).mean()
      series = series.reset_index(level=0, drop=True)  # å…³é”®ï¼
      
      # è¾“å‡º
      result_df = pd.DataFrame(index=df.index)
      result_df["factor_name"] = series.astype("float32")
      result_df.index.names = df.index.names
      result_df.to_hdf("result.h5", key="data", mode="w")
  ```
```

**æ¨èæ–¹æ¡ˆ**ï¼šä½¿ç”¨æ–¹æ¡ˆ1ï¼ˆæ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼‰ï¼ŒåŸå› ï¼š
1. æ¨¡å—åŒ–ç¨‹åº¦é«˜ï¼Œä¾¿äºç»´æŠ¤å’Œå¤ç”¨
2. å¯ä»¥åœ¨ä¸åŒæç¤ºè¯ä¸­çµæ´»ç»„åˆ
3. ä¾¿äºå•ç‹¬æµ‹è¯•å’ŒéªŒè¯æ¯ä¸ªæ¨¡å—
4. ç¬¦åˆYAMLçš„includeæœºåˆ¶ï¼Œå®ç°ç®€å•

---

### é—®é¢˜2ï¼šç¼ºå°‘é”™è¯¯é¢„é˜²ï¼ˆä¸¥é‡åº¦ï¼šé«˜ï¼‰

#### é—®é¢˜æè¿°
æç¤ºè¯åªè¯´æ˜"åº”è¯¥åšä»€ä¹ˆ"ï¼Œæ²¡æœ‰è¯´æ˜"ä¸åº”è¯¥åšä»€ä¹ˆ"ä»¥åŠ"å¦‚ä½•é¿å…å¸¸è§é”™è¯¯"ã€‚

#### å…·ä½“æ¡ˆä¾‹

**æ¡ˆä¾‹ï¼š`qlib_factor_interface`ï¼ˆç¬¬88-90è¡Œï¼‰**
```yaml
# å¯¹äº groupby+rolling çš„å…¸å‹æ¨¡å¼ï¼Œè¯·ä½¿ç”¨ï¼š
# s = df["x"].groupby(level="instrument").rolling(window=K, min_periods=K).func(...)
# s = s.reset_index(level=0, drop=True)  # æ¢å¤ä¸ºä¸ df.index å¯¹é½
```

**é—®é¢˜**ï¼š
- åªæ˜¯ç¤ºä¾‹ï¼Œæ²¡æœ‰è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦reset_index
- æ²¡æœ‰è¯´æ˜ä¸è¿™æ ·åšä¼šå¯¼è‡´ä»€ä¹ˆé”™è¯¯
- æ²¡æœ‰æä¾›é”™è¯¯ç¤ºä¾‹å’Œæ­£ç¡®ç¤ºä¾‹çš„å¯¹æ¯”

**å¯¹æ¯”å®é™…é”™è¯¯**ï¼š
æ ¹æ®ä¹‹å‰çš„é”™è¯¯åˆ†æï¼Œgroupby+rollingé”™è¯¯æ˜¯å¯¼è‡´å¤šè½®codingçš„ä¸»è¦åŸå› ï¼ˆ100+æ¬¡ï¼‰ï¼Œä½†æç¤ºè¯ä¸­åªæœ‰2è¡Œè½»ææ·¡å†™çš„è¯´æ˜ã€‚

#### å»ºè®®ä¿®æ”¹

```yaml
# åœ¨æç¤ºè¯ä¸­æ·»åŠ è¯¦ç»†çš„é”™è¯¯é¢„é˜²ç« èŠ‚
ã€é”™è¯¯é¢„é˜²ï¼ˆå¿…é¡»é˜…è¯»ï¼‰ã€‘

é”™è¯¯1ï¼šgroupby+rollingç´¢å¼•ä¸å¯¹é½
  é”™è¯¯ä»£ç ï¼š
    ```python
    corr = df.groupby(level="instrument")[["x", "y"]].rolling(window=10).corr()
    # é”™è¯¯ï¼šcorrçš„ç´¢å¼•æ˜¯(datetime, instrument, level_2)ï¼Œä¸æ˜¯åŸå§‹ç´¢å¼•
    result_df = pd.DataFrame(index=df.index)
    result_df["corr"] = corr  # æŠ¥é”™ï¼šç´¢å¼•ä¸åŒ¹é…
    ```
  
  æ­£ç¡®ä»£ç ï¼š
    ```python
    corr = df.groupby(level="instrument")[["x", "y"]].rolling(window=10).corr()
    corr = corr.reset_index(level=0, drop=True)  # æ¢å¤ç´¢å¼•å¯¹é½
    result_df = pd.DataFrame(index=df.index)
    result_df["corr"] = corr  # æˆåŠŸ
    ```
  
  é”™è¯¯ä¿¡æ¯ï¼šValueError: cannot reindex on an axis with duplicate labels
  è§£å†³æ–¹æ¡ˆï¼šåœ¨groupby+rollingåç«‹å³ä½¿ç”¨reset_index(level=0, drop=True)

é”™è¯¯2ï¼šåˆ—åæ··æ·†
  é”™è¯¯ä»£ç ï¼š
    ```python
    df = pd.read_hdf("daily_pv.h5", key="data")
    # é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨$close
    close_price = df["$close"]  # å¯èƒ½æˆåŠŸï¼Œä½†ä¸åç»­ä»£ç ä¸ä¸€è‡´
    # åç»­åˆä½¿ç”¨close
    volume = df["volume"]  # KeyError: 'volume'
    ```
  
  æ­£ç¡®ä»£ç ï¼š
    ```python
    df = pd.read_hdf("daily_pv.h5", key="data")
    rename_map = {"$open": "open", "$close": "close", "$volume": "volume"}
    df = df.rename(columns=rename_map)
    # åç»­åªä½¿ç”¨é‡å‘½ååçš„å­—æ®µ
    close_price = df["close"]
    volume = df["volume"]  # æˆåŠŸ
    ```

é”™è¯¯3ï¼šè¾“å‡ºæ ¼å¼é”™è¯¯
  é”™è¯¯ä»£ç ï¼š
    ```python
    result_df = pd.DataFrame({"factor": series})
    # é”™è¯¯ï¼šç´¢å¼•åç§°ä¸¢å¤±
    result_df.to_hdf("result.h5", key="data", mode="w")
    # åç»­åŠ è½½æ—¶ç´¢å¼•åç§°ä¸ºNoneï¼Œå¯¼è‡´é—®é¢˜
    ```
  
  æ­£ç¡®ä»£ç ï¼š
    ```python
    result_df = pd.DataFrame(index=df.index)
    result_df["factor_name"] = series.astype("float32")
    result_df.index.names = df.index.names  # ç»§æ‰¿ç´¢å¼•åç§°
    result_df.to_hdf("result.h5", key="data", mode="w")
    ```
```

---

### é—®é¢˜3ï¼šçº¦æŸä¸ä¸€è‡´ï¼ˆä¸¥é‡åº¦ï¼šä¸­ï¼‰

#### é—®é¢˜æè¿°
ä¸åŒæç¤ºè¯ä¸­å¯¹åŒä¸€äº‹é¡¹çš„è¦æ±‚ä¸ä¸€è‡´ï¼Œå¯¼è‡´LLMå›°æƒ‘ã€‚

#### å…·ä½“æ¡ˆä¾‹

**æ¡ˆä¾‹1ï¼štry-exceptä½¿ç”¨**
- `factor_coder/prompts.yaml` ç¬¬44è¡Œï¼š`Don't write any try-except block in your python code.`
- `scenarios/qlib/prompts.yaml` ç¬¬229è¡Œï¼š`åœ¨å› å­å®ç°å‡½æ•°ä¸­ï¼Œç¦æ­¢ä½¿ç”¨ try/except åŒ…è£¹æ•´ä¸ªä¸»é€»è¾‘ã€‚`
- `scenarios/qlib/prompts.yaml` ç¬¬230è¡Œï¼š`åªæœ‰åœ¨æå°‘æ•°éœ€è¦ç²¾ç»†å¤„ç†çš„å±€éƒ¨é€»è¾‘ä¸­ï¼Œæ‰å¯ä»¥ä½¿ç”¨å°èŒƒå›´çš„ try/except`

**é—®é¢˜**ï¼š
- ä¸€ä¸ªè¯´"ä¸è¦å†™"ï¼Œå¦ä¸€ä¸ªè¯´"ç¦æ­¢åŒ…è£¹æ•´ä¸ªä¸»é€»è¾‘"
- LLMå¯èƒ½ä¸çŸ¥é“ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨try-except
- ç¼ºå°‘å…·ä½“çš„ä½¿ç”¨åœºæ™¯è¯´æ˜

**æ¡ˆä¾‹2ï¼šè¾“å‡ºæ ¼å¼**
- `factor_coder/prompts.yaml` ç¬¬45è¡Œï¼š`The index of the dataframe is the "datetime" and "instrument"`
- `qlib_factor_interface` ç¬¬115è¡Œï¼š`index`ï¼šMultiIndex(`datetime`, `instrument`)ï¼Œä¸ `df.index` å®Œå…¨ä¸€è‡´å¹¶å·²æ’åº
- `qlib_factor_interface` ç¬¬99è¡Œï¼š`result_df.index.names = df.index.names`

**é—®é¢˜**ï¼š
- ä¸€ä¸ªè¯´ç´¢å¼•æ˜¯"datetime"å’Œ"instrument"ï¼ˆå­—ç¬¦ä¸²ï¼‰
- å¦ä¸€ä¸ªè¯´åº”è¯¥ç»§æ‰¿df.index.namesï¼ˆå˜é‡ï¼‰
- LLMå¯èƒ½ä¸çŸ¥é“åº”è¯¥ç”¨å“ªç§æ–¹å¼

#### å»ºè®®ä¿®æ”¹

```yaml
# ç»Ÿä¸€çº¦æŸè§„èŒƒ
ã€ç»Ÿä¸€çº¦æŸè§„èŒƒã€‘

1. try-exceptä½¿ç”¨ï¼š
   - ç¦æ­¢ï¼šç”¨try-exceptåŒ…è£¹æ•´ä¸ªä¸»é€»è¾‘
   - å…è®¸ï¼šåœ¨æå°‘æ•°éœ€è¦ç²¾ç»†å¤„ç†çš„å±€éƒ¨é€»è¾‘ä¸­ä½¿ç”¨å°èŒƒå›´try-except
   - ç¤ºä¾‹ï¼š
     ```python
     # ç¦æ­¢
     try:
         # æ•´ä¸ªä¸»é€»è¾‘
         df = pd.read_hdf(...)
         series = df["close"].rolling(10).mean()
         result_df = pd.DataFrame(index=df.index)
         result_df.to_hdf(...)
     except Exception as e:
         pass  # åæ‰å¼‚å¸¸
     
     # å…è®¸
     df = pd.read_hdf(...)
     try:
         # å±€éƒ¨é€»è¾‘ï¼šå¤„ç†å¯èƒ½ç¼ºå¤±çš„åˆ—
         if "volume" in df.columns:
             df["volume"] = df["volume"].fillna(0)
     except Exception as e:
         df["volume"] = 0  # é™çº§å¤„ç†
     series = df["close"].rolling(10).mean()
     ```

2. è¾“å‡ºæ ¼å¼ï¼š
   - å¿…é¡»ä½¿ç”¨ï¼šresult_df.index.names = df.index.names
   - ç¦æ­¢ï¼šresult_df.index.names = ["datetime", "instrument"]
   - åŸå› ï¼šdf.index.nameså¯èƒ½åŒ…å«é¢å¤–çš„å…ƒæ•°æ®ï¼Œç›´æ¥ç»§æ‰¿æ›´å®‰å…¨
```

---

### é—®é¢˜4ï¼šè¯­è¨€æ··ç”¨ï¼ˆä¸¥é‡åº¦ï¼šä¸­ï¼‰

#### é—®é¢˜æè¿°
ä¸­è‹±æ–‡æ··ç”¨ï¼Œå¯¼è‡´LLMè¾“å‡ºè¯­è¨€ä¸ä¸€è‡´ã€‚

#### å…·ä½“æ¡ˆä¾‹

**æ¡ˆä¾‹ï¼š`qlib_factor_interface`**
- ç¬¬31-34è¡Œï¼šä¸­æ–‡è¯´æ˜ï¼ˆ"å¯¹äºæ¯ä¸€ä¸ªå› å­ï¼Œè¯·ç”¨ã€Œç®€ä½“ä¸­æ–‡ã€ç»™å‡ºæ¸…æ™°çš„åŸºç¡€è§£é‡Š"ï¼‰
- ç¬¬42-109è¡Œï¼šè‹±æ–‡æ¨¡æ¿å’Œæ³¨é‡Š
- ç¬¬119-182è¡Œï¼šä¸­æ–‡è¯´æ˜ï¼ˆ"æ•°æ®åŠ è½½ä¸å­—æ®µåè§„èŒƒ"ï¼‰
- ç¬¬45-49è¡Œï¼šä¸­è‹±æ–‡æ··ç”¨æ³¨é‡Š

**æ¡ˆä¾‹ï¼š`scenarios/qlib/prompts.yaml`**
- ç¬¬66-68è¡Œï¼šè‹±æ–‡è¾“å‡ºæ ¼å¼è¦æ±‚ï¼Œä½†è¦æ±‚"**All natural-language content here must be written in concise professional Chinese.**"
- ç¬¬188è¡Œï¼šè‹±æ–‡è¯´æ˜ï¼Œä½†è¦æ±‚"æ‰€æœ‰æœ€ç»ˆæ–‡æœ¬è§£é‡Šå’Œè‡ªç„¶è¯­è¨€æ‘˜è¦éƒ½åº”è¯¥ç”¨**ä¸­æ–‡**"

**é—®é¢˜**ï¼š
- LLMä¸çŸ¥é“åº”è¯¥ç”¨ä¸­æ–‡è¿˜æ˜¯è‹±æ–‡è¾“å‡º
- ä»£ç æ³¨é‡Šå’Œè¯´æ˜æ··ç”¨ä¸­è‹±æ–‡ï¼Œå¯¼è‡´LLMç”Ÿæˆçš„ä»£ç ä¹Ÿæ··ç”¨
- ä¸ç”¨æˆ·åå¥½ï¼ˆä¸­æ–‡ï¼‰ä¸ä¸€è‡´

#### å»ºè®®ä¿®æ”¹

```yaml
# ç»Ÿä¸€è¯­è¨€è§„èŒƒ
ã€è¯­è¨€è§„èŒƒã€‘

1. ä»£ç æ³¨é‡Šï¼šä½¿ç”¨ä¸­æ–‡
   ```python
   # è¯»å–æ•°æ®
   df = pd.read_hdf("daily_pv.h5", key="data").sort_index()
   
   # ç»Ÿä¸€é‡å‘½å
   rename_map = {"$open": "open", "$close": "close"}
   df = df.rename(columns=rename_map)
   
   # å› å­è®¡ç®—
   series = df["close"].groupby(level="instrument").rolling(10).mean()
   ```

2. å˜é‡åï¼šä½¿ç”¨è‹±æ–‡ï¼ˆä¿æŒä»£ç å¯è¯»æ€§ï¼‰
   ```python
   # æ­£ç¡®
   close_price = df["close"]
   rolling_mean = series.rolling(10).mean()
   
   # é¿å…
   æ”¶ç›˜ä»· = df["close"]
   æ»šåŠ¨å‡å€¼ = series.rolling(10).mean()
   ```

3. é”™è¯¯ä¿¡æ¯ï¼šä½¿ç”¨ä¸­æ–‡
   ```python
   if missing:
       raise ValueError(f"ç¼ºå°‘å¿…è¦åˆ—: {missing}. è¯·ä½¿ç”¨å¯ç”¨å­—æ®µé‡æ–°è®¾è®¡å› å­ã€‚")
   ```

4. è¾“å‡ºè¯´æ˜ï¼šä½¿ç”¨ä¸­æ–‡
   ```python
   # åœ¨ä»£ç ä¸­æ·»åŠ ä¸­æ–‡è¯´æ˜æ³¨é‡Š
   # æœ¬å› å­è®¡ç®—10æ—¥åŠ¨é‡ï¼Œåæ˜ ä»·æ ¼è¶‹åŠ¿
   momentum = df["close"] / df["close"].groupby(level="instrument").shift(1) - 1
   ```
```

---

### é—®é¢˜5ï¼šå†—ä½™å†…å®¹ï¼ˆä¸¥é‡åº¦ï¼šä¸­ï¼‰

#### é—®é¢˜æè¿°
æç¤ºè¯ä¸­åŒ…å«å¤§é‡ä¸å½“å‰ä»»åŠ¡æ— å…³çš„ä¿¡æ¯ã€‚

#### å…·ä½“æ¡ˆä¾‹

**æ¡ˆä¾‹1ï¼š`qlib_factor_experiment_setting`ï¼ˆç¬¬320-333è¡Œï¼‰**
```yaml
#### è®¡ç®—èµ„æºä¸è®­ç»ƒè´Ÿè½½å»ºè®®ï¼ˆè¯·ä¼˜å…ˆæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼Œä»¥å……åˆ†åˆ©ç”¨æœ¬æœº 12 æ ¸ 24 çº¿ç¨‹ + GPUï¼‰
- **è®­ç»ƒè½®æ•°ä¸ batch å¤§å°**ï¼š
  - å¯¹äºä¸»è¦å®éªŒï¼Œè¯·é¿å…ä½¿ç”¨è¿‡å°é…ç½®ï¼ˆå¦‚ `n_epochs < 100`ã€`batch_size < 256`ï¼‰ã€‚
  - æ¨èé…ç½®èŒƒå›´ï¼š`n_epochs` åœ¨ `200~300`ï¼›`batch_size` ä»¥ `512` ä¸ºä¼˜å…ˆï¼ˆå¦‚æ˜¾å­˜ä¸è¶³å¯é™åˆ° `256`ï¼‰ã€‚
- **å¹¶è¡Œåº¦è®¾ç½®ï¼ˆCPUï¼‰**ï¼š
  - å¯¹æ”¯æŒ `n_jobs` çš„æ¨¡å‹æˆ–æ•°æ®å¤„ç†ç»„ä»¶ï¼Œä¼˜å…ˆè®¾ç½®ä¸º `n_jobs: 12`ï¼ˆæ¥è¿‘ç‰©ç†æ ¸å¿ƒæ•°ï¼‰ã€‚
  - å¦‚ YAML ä¸­å­˜åœ¨ `workers` / `num_workers` / `processes` ç­‰å­—æ®µï¼Œå¯è®¾ç½®åœ¨ `8~12` ä¹‹é—´ï¼Œé¿å…è¿œé«˜äº CPU æ ¸å¿ƒæ•°ã€‚
- **GPU ä½¿ç”¨**ï¼š
  - å¯¹åŸºäº PyTorch çš„æ—¶åºæ¨¡å‹ï¼ˆå¦‚ `GRU_TimeSeries_Model`ï¼‰ï¼Œå¿…é¡»ä¿è¯ `use_GPU: True`ï¼Œ`device: "cuda:0"`ï¼Œç¦æ­¢éšæ„æ”¹æˆ `cpu`ã€‚
- **é“¾è·¯ç¨³å®šä¼˜å…ˆ**ï¼š
  - åœ¨åŠ å¤§è®­ç»ƒè´Ÿè½½å‰ï¼Œå…ˆç”¨è¾ƒå°å¾ªç¯ï¼ˆå¦‚ `--loop-n 1`ï¼‰ç¡®è®¤æ•´æ¡å› å­ä¸ Qlib è®­ç»ƒé“¾è·¯å®Œå…¨æ‰“é€š...
```

**é—®é¢˜**ï¼š
- è¿™äº›æ˜¯æ¨¡å‹è®­ç»ƒçš„é…ç½®ï¼Œä¸å› å­ç¼–ç æ— å…³
- å› å­ç¼–ç ä¸éœ€è¦çŸ¥é“è®­ç»ƒè½®æ•°ã€batchå¤§å°ã€GPUä½¿ç”¨ç­‰
- è¿™äº›ä¿¡æ¯åº”è¯¥åœ¨`model_coder`æç¤ºè¯ä¸­

**æ¡ˆä¾‹2ï¼š`qlib_factor_experiment_setting`ï¼ˆç¬¬335-350è¡Œï¼‰**
```yaml
#### è‚¡ç¥¨æ± ç­›é€‰ä¸æ¯æ—¥æŒ‡æ ‡å› å­çš„ä¼˜å…ˆä½¿ç”¨åŸåˆ™
- åœ¨å› å­ä¸ç­–ç•¥æ¼”è¿›è¿‡ç¨‹ä¸­ï¼Œ**ä¼˜å…ˆä½¿ç”¨é¢„è®¡ç®—çš„ daily_basic å› å­è¡¨ï¼ˆä¼°å€¼ã€å¸‚å€¼ã€æµåŠ¨æ€§ç­‰ï¼‰åšç¨³å¥åŒ–ä¸é£é™©æ§åˆ¶**...
- åœ¨åŠ å…¥æ–°å› å­å‰ï¼Œå…ˆç¡®ä¿åŸºç¡€å› å­é›†åœ¨ IC ä¸å›æµ‹ç¨³å®šæ€§ä¸Šä¸å†å‡ºç°ç³»ç»Ÿæ€§å´©å...

#### ç­–ç•¥æ¼”è¿›ä¼˜å…ˆçº§ï¼ˆå½“ IC è¿ç»­ä¸º NaN æˆ–æ”¶ç›Šæ˜¾è‘—ä¸ºè´Ÿæ—¶ï¼‰
- è‹¥æœ€è¿‘è‹¥å¹²è½®å®éªŒä¸­ï¼Œ**æ¨ªæˆªé¢ IC å¤§å¤šä¸º NaN/æ¥è¿‘ 0ï¼Œä¸”ç»„åˆå¹´åŒ–æ”¶ç›Šæ˜æ˜¾ä¸ºè´Ÿã€æœ€å¤§å›æ’¤è¿‡å¤§**ï¼Œè¯·ä¼˜å…ˆæ’æŸ¥å¹¶æ¼”è¿›ä»¥ä¸‹æ–¹å‘...
```

**é—®é¢˜**ï¼š
- è¿™äº›æ˜¯ç­–ç•¥æ¼”è¿›çš„å»ºè®®ï¼Œä¸å› å­ç¼–ç æ— å…³
- å› å­ç¼–ç åªéœ€è¦çŸ¥é“å¦‚ä½•è®¡ç®—å› å­å€¼ï¼Œä¸éœ€è¦çŸ¥é“å¦‚ä½•è¯„ä¼°å› å­æ•ˆæœ
- è¿™äº›ä¿¡æ¯åº”è¯¥åœ¨`proposal`æˆ–`feedback`æç¤ºè¯ä¸­

#### å»ºè®®ä¿®æ”¹

```yaml
# ç§»é™¤å†—ä½™å†…å®¹ï¼Œåªä¿ç•™å› å­ç¼–ç éœ€è¦çš„ä¿¡æ¯
qlib_factor_experiment_setting: |-
  ã€æ•°æ®é›†ä¿¡æ¯ã€‘
  - æ•°æ®é›†ï¼šAIstock A-share (non-ST, non-delisted)
  - è‚¡ç¥¨ä»£ç æ ¼å¼ï¼šQlibé£æ ¼ï¼ˆå¦‚ `000001.SZ`, `600000.SH`ï¼‰
  - æ•°æ®æ–‡ä»¶ï¼š
    - daily_pv.h5ï¼šæ—¥çº¿ä»·é‡æ•°æ®ï¼Œç´¢å¼•ä¸ºMultiIndex(datetime, instrument)
    - static_factors.parquetï¼šé™æ€å› å­ï¼ˆå¯é€‰ï¼‰ï¼ŒåŒ…å«ä¼°å€¼ã€å¸‚å€¼ã€æµåŠ¨æ€§ç­‰å­—æ®µ
  
  ã€å¯ç”¨å­—æ®µã€‘
  - ä»·é‡å­—æ®µï¼šopen, high, low, close, volume, amount
  - é™æ€å­—æ®µï¼šdb_*ï¼ˆä¼°å€¼ã€å¸‚å€¼ç­‰ï¼‰ã€mf_*ï¼ˆèµ„é‡‘æµç­‰ï¼‰
  - æ³¨æ„ï¼šåªèƒ½ä½¿ç”¨schemaä¸­åˆ—å‡ºçš„å­—æ®µï¼Œç¦æ­¢ç¼–é€ å­—æ®µå
  
  ã€è¾“å‡ºè¦æ±‚ã€‘
  - å› å­å€¼ï¼šfloat32ç±»å‹
  - ç´¢å¼•ï¼šMultiIndex(datetime, instrument)
  - æ–‡ä»¶ï¼šresult.h5
```

---

### é—®é¢˜6ï¼šç¤ºä¾‹ä¸å¤Ÿå…·ä½“ï¼ˆä¸¥é‡åº¦ï¼šä¸­ï¼‰

#### é—®é¢˜æè¿°
æä¾›çš„ç¤ºä¾‹è¿‡äºç®€å•ï¼Œæ²¡æœ‰è¦†ç›–å®é™…ä½¿ç”¨ä¸­çš„å¤æ‚åœºæ™¯ã€‚

#### å…·ä½“æ¡ˆä¾‹

**æ¡ˆä¾‹ï¼š`qlib_factor_interface`ï¼ˆç¬¬85-90è¡Œï¼‰**
```yaml
# ç¤ºæ„ï¼šä»¥ä¸‹åªæ˜¯ä¸€ä¸ªå ä½ç¤ºä¾‹ï¼Œè¯·åœ¨å®é™…ä»»åŠ¡ä¸­ç”¨ä½ çš„çœŸå®é€»è¾‘å®Œå…¨æ›¿æ¢æ‰è¯¥ Series çš„æ„é€ ã€‚
series = df["close"] / df["close"].groupby(level="instrument").shift(1) - 1

# å¯¹äº groupby+rolling çš„å…¸å‹æ¨¡å¼ï¼Œè¯·ä½¿ç”¨ï¼š
# s = df["x"].groupby(level="instrument").rolling(window=K, min_periods=K).func(...)
# s = s.reset_index(level=0, drop=True)  # æ¢å¤ä¸ºä¸ df.index å¯¹é½
```

**é—®é¢˜**ï¼š
- ç¤ºä¾‹è¿‡äºç®€å•ï¼Œæ²¡æœ‰å±•ç¤ºgroupby+rollingçš„å®Œæ•´ç”¨æ³•
- æ²¡æœ‰å±•ç¤ºå¦‚ä½•å¤„ç†å¤šåˆ—ã€å¦‚ä½•ä½¿ç”¨ä¸åŒçš„èšåˆå‡½æ•°
- æ²¡æœ‰å±•ç¤ºå¦‚ä½•ç»“åˆstatic_factors.parquet

**å¯¹æ¯”å®é™…éœ€æ±‚**ï¼š
æ ¹æ®é”™è¯¯åˆ†æï¼Œå¾ˆå¤šä»»åŠ¡éœ€è¦ä½¿ç”¨static_factors.parquetä¸­çš„å­—æ®µï¼Œä½†æç¤ºè¯ä¸­åªæœ‰ç®€å•çš„ä»·é‡ç¤ºä¾‹ã€‚

#### å»ºè®®ä¿®æ”¹

```yaml
# æä¾›æ›´å…·ä½“çš„ç¤ºä¾‹
ã€å®Œæ•´ç¤ºä¾‹ã€‘

ç¤ºä¾‹1ï¼šç®€å•åŠ¨é‡å› å­
```python
def calculate_momentum_10d():
    df = pd.read_hdf("daily_pv.h5", key="data").sort_index()
    
    # é‡å‘½å
    rename_map = {"$open": "open", "$close": "close", "$volume": "volume"}
    df = df.rename(columns=rename_map)
    
    # å› å­è®¡ç®—ï¼š10æ—¥æ”¶ç›Šç‡
    momentum = df["close"] / df["close"].groupby(level="instrument").shift(10) - 1
    
    # è¾“å‡º
    result_df = pd.DataFrame(index=df.index)
    result_df["momentum_10d"] = momentum.astype("float32")
    result_df.index.names = df.index.names
    result_df.to_hdf("result.h5", key="data", mode="w")
    return result_df
```

ç¤ºä¾‹2ï¼šä½¿ç”¨groupby+rolling
```python
def calculate_volatility_20d():
    df = pd.read_hdf("daily_pv.h5", key="data").sort_index()
    
    # é‡å‘½å
    rename_map = {"$open": "open", "$close": "close", "$volume": "volume"}
    df = df.rename(columns=rename_map)
    
    # å› å­è®¡ç®—ï¼š20æ—¥æ³¢åŠ¨ç‡
    returns = df["close"] / df["close"].groupby(level="instrument").shift(1) - 1
    volatility = returns.groupby(level="instrument").rolling(window=20).std()
    volatility = volatility.reset_index(level=0, drop=True)  # å…³é”®ï¼æ¢å¤ç´¢å¼•
    
    # è¾“å‡º
    result_df = pd.DataFrame(index=df.index)
    result_df["volatility_20d"] = volatility.astype("float32")
    result_df.index.names = df.index.names
    result_df.to_hdf("result.h5", key="data", mode="w")
    return result_df
```

ç¤ºä¾‹3ï¼šä½¿ç”¨static_factors.parquet
```python
def calculate_turnover_ratio():
    df = pd.read_hdf("daily_pv.h5", key="data").sort_index()
    
    # é‡å‘½å
    rename_map = {"$open": "open", "$close": "close", "$volume": "volume", "$amount": "amount"}
    df = df.rename(columns=rename_map)
    
    # è¯»å–é™æ€å› å­ï¼ˆåªè¯»å–éœ€è¦çš„åˆ—ï¼‰
    required_static_cols = ["db_turnover_rate", "db_circ_mv"]
    static_df = pd.read_parquet("static_factors.parquet", columns=required_static_cols).sort_index()
    
    # åˆå¹¶æ•°æ®
    df = df.join(static_df, how="left")
    
    # å› å­è®¡ç®—ï¼šæ¢æ‰‹ç‡
    turnover = df["db_turnover_rate"]
    
    # è¾“å‡º
    result_df = pd.DataFrame(index=df.index)
    result_df["turnover_ratio"] = turnover.astype("float32")
    result_df.index.names = df.index.names
    result_df.to_hdf("result.h5", key="data", mode="w")
    return result_df
```

ç¤ºä¾‹4ï¼šå¤šåˆ—groupby+rolling
```python
def calculate_price_volume_correlation():
    df = pd.read_hdf("daily_pv.h5", key="data").sort_index()
    
    # é‡å‘½å
    rename_map = {"$open": "open", "$close": "close", "$volume": "volume"}
    df = df.rename(columns=rename_map)
    
    # è®¡ç®—æ”¶ç›Šç‡
    returns = df["close"] / df["close"].groupby(level="instrument").shift(1) - 1
    volume_change = df["volume"] / df["volume"].groupby(level="instrument").shift(1) - 1
    
    # åˆå¹¶åˆ°ä¸€èµ·
    df["returns"] = returns
    df["volume_change"] = volume_change
    
    # å› å­è®¡ç®—ï¼šä»·é‡ç›¸å…³æ€§
    corr = df.groupby(level="instrument")[["returns", "volume_change"]].rolling(window=20).corr()
    # corrçš„ç´¢å¼•æ˜¯(datetime, instrument, level_2)ï¼Œæå–returnså’Œvolume_changeçš„ç›¸å…³æ€§
    corr = corr.reset_index(level=0, drop=True)
    corr = corr.xs("returns", level="level_2")["volume_change"]
    
    # è¾“å‡º
    result_df = pd.DataFrame(index=df.index)
    result_df["price_volume_corr"] = corr.astype("float32")
    result_df.index.names = df.index.names
    result_df.to_hdf("result.h5", key="data", mode="w")
    return result_df
```
```

---

### é—®é¢˜7ï¼šé”™è¯¯å¼•å¯¼ï¼ˆä¸¥é‡åº¦ï¼šä½ï¼‰

#### é—®é¢˜æè¿°
æŸäº›æç¤ºè¯å¯èƒ½å¼•å¯¼LLMåšå‡ºé”™è¯¯çš„é€‰æ‹©ã€‚

#### å…·ä½“æ¡ˆä¾‹

**æ¡ˆä¾‹1ï¼š`qlib_factor_strategy`ï¼ˆç¬¬184-223è¡Œï¼‰**
```yaml
qlib_factor_strategy: |-
  Ensure that for every step of data processing, the data format (including indexes) is clearly explained through comments.
  Each transformation or calculation should be accompanied by a detailed description of how the data is structured...
  
  1. **Start with multi-level index**:  
    ```python
    # The initial DataFrame has a multi-level index with 'datetime' and 'instrument'.
    # To access the 'datetime' index, use df.index.get_level_values('datetime').
    datetime_values = df.index.get_level_values('datetime')
    ```
  
  2. **Reset the index if necessary**:  
    ```python
    # Resetting the index to move 'datetime' and 'instrument' from the index to columns.
    # This operation flattens the multi-index structure.
    df = df.reset_index()
    ```
```

**é—®é¢˜**ï¼š
- æç¤ºè¦æ±‚"æ¯ä¸ªæ­¥éª¤éƒ½è¦è¯¦ç»†æ³¨é‡Š"ï¼Œä½†å®é™…å› å­ä»£ç ä¸éœ€è¦è¿™ä¹ˆå¤šæ³¨é‡Š
- ç¤ºä¾‹å±•ç¤ºäº†`reset_index()`ï¼Œä½†æ ¹æ®æ ¸å¿ƒçº¦æŸï¼Œè¿™æ˜¯è¢«ç¦æ­¢çš„æ“ä½œ
- LLMå¯èƒ½è¯¯ä»¥ä¸ºå¯ä»¥ä½¿ç”¨reset_index()

**æ¡ˆä¾‹2ï¼š`model_coder/prompts.yaml`ï¼ˆç¬¬18è¡Œï¼‰**
```yaml
"training_hyperparameters" {  # All values are for reference; you can set them yourself
    "n_epochs": "20",
    "lr": "1e-3",
    "early_stop": 5,
    "batch_size": 256,
    "weight_decay": 1e-4,
}
```

**é—®é¢˜**ï¼š
- `n_epochs: 20`å¤ªå°ï¼Œä¸`qlib_factor_experiment_setting`ä¸­çš„å»ºè®®ï¼ˆ200-300ï¼‰ä¸ä¸€è‡´
- LLMå¯èƒ½ä½¿ç”¨è¿™ä¸ªé»˜è®¤å€¼ï¼Œå¯¼è‡´è®­ç»ƒä¸å……åˆ†

#### å»ºè®®ä¿®æ”¹

```yaml
# ä¿®æ­£é”™è¯¯å¼•å¯¼
qlib_factor_strategy: |-
  ã€ä»£ç æ³¨é‡Šè¦æ±‚ã€‘
  - åªåœ¨å…³é”®æ­¥éª¤æ·»åŠ ç®€æ´æ³¨é‡Š
  - ä¸è¦è¿‡åº¦æ³¨é‡Šï¼Œä¿æŒä»£ç ç®€æ´
  - æ³¨é‡Šä½¿ç”¨ä¸­æ–‡
  
  ã€ç¦æ­¢æ“ä½œã€‘
  - ä¸è¦ä½¿ç”¨reset_index()ã€droplevel()ã€swaplevel()ç­‰æ”¹å˜ç´¢å¼•ç»“æ„çš„æ“ä½œ
  - ä¸è¦ä¿®æ”¹df.indexçš„ç»“æ„
  - ä¸è¦æ‰‹å·¥è®¾ç½®result_df.index.names = ["datetime", "instrument"]

# ä¿®æ­£é»˜è®¤å‚æ•°
"training_hyperparameters": {
    "n_epochs": "200",  # ä¿®æ”¹ä¸ºä¸å®éªŒè®¾ç½®ä¸€è‡´
    "lr": "1e-3",
    "early_stop": 10,
    "batch_size": 512,
    "weight_decay": 1e-4,
}
```

---

## ä¸‰ã€å…¶ä»–æç¤ºè¯é—®é¢˜

### é—®é¢˜8ï¼š`model_coder/prompts.yaml`ï¼ˆä¸¥é‡åº¦ï¼šä¸­ï¼‰

#### å…·ä½“æ¡ˆä¾‹

**ç¬¬48è¡Œï¼š**
```yaml
Your code should be very similar to the former code which means your code should be ninety more percent same as the former code! You should not modify the right part of the code.
```

**é—®é¢˜**ï¼š
- "ninety more percent same"è¯­æ³•é”™è¯¯ï¼Œåº”è¯¥æ˜¯"ninety percent more same"æˆ–"90% same"
- "right part of the code"è¡¨è¿°ä¸æ¸…ï¼Œä¸çŸ¥é“æŒ‡å“ªéƒ¨åˆ†
- è¿‡åº¦é™åˆ¶LLMçš„ä¿®æ”¹ç©ºé—´ï¼Œå¯èƒ½å¯¼è‡´æ— æ³•ä¿®å¤é”™è¯¯

**å»ºè®®ä¿®æ”¹**ï¼š
```yaml
Your code should be based on the former code, keeping the overall structure and logic similar. Only modify the parts that need to be fixed based on the feedback. Do not completely rewrite the code.
```

### é—®é¢˜9ï¼š`scenarios/qlib/prompts.yaml`ï¼ˆä¸¥é‡åº¦ï¼šä½ï¼‰

#### å…·ä½“æ¡ˆä¾‹

**ç¬¬111è¡Œï¼š**
```yaml
"factor name 1": {
    "description": "description of factor 1, start with its type, e.g. [Momentum Factor]",
```

**é—®é¢˜**ï¼š
- ç¤ºä¾‹ä½¿ç”¨è‹±æ–‡ï¼Œä½†æ ¹æ®è¯­è¨€è§„èŒƒåº”è¯¥ç”¨ä¸­æ–‡
- ä¸å®é™…è¾“å‡ºè¦æ±‚ä¸ä¸€è‡´

**å»ºè®®ä¿®æ”¹**ï¼š
```yaml
"å› å­åç§°1": {
    "description": "å› å­æè¿°ï¼Œä»¥ç±»å‹å¼€å¤´ï¼Œä¾‹å¦‚ï¼š[åŠ¨é‡å› å­]",
```

---

## å››ã€ä¿®æ”¹ä¼˜å…ˆçº§å»ºè®®

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“èŒƒå›´ | é¢„æœŸæ•ˆæœ |
|--------|------|----------|----------|
| **P0** | ä¿¡æ¯è¿‡è½½ | factor_coder | å‡å°‘2-3è½®coding |
| **P0** | ç¼ºå°‘é”™è¯¯é¢„é˜² | factor_coder | å‡å°‘1-2è½®coding |
| **P1** | çº¦æŸä¸ä¸€è‡´ | æ‰€æœ‰æç¤ºè¯ | æå‡ä»£ç è´¨é‡ |
| **P1** | è¯­è¨€æ··ç”¨ | æ‰€æœ‰æç¤ºè¯ | ç»Ÿä¸€è¾“å‡ºè¯­è¨€ |
| **P2** | å†—ä½™å†…å®¹ | qlib_factor_experiment_setting | ç¼©çŸ­æç¤ºè¯é•¿åº¦ |
| **P2** | ç¤ºä¾‹ä¸å¤Ÿå…·ä½“ | factor_coder | å‡å°‘å¸¸è§é”™è¯¯ |
| **P3** | é”™è¯¯å¼•å¯¼ | qlib_factor_strategy | é¿å…è¯¯å¯¼ |

---

## äº”ã€é‡åŒ–åœºæ™¯æç¤ºè¯è¯¦ç»†æ¸…å•

### 5.1 é‡åŒ–åœºæ™¯æç¤ºè¯æ–‡ä»¶ç»Ÿè®¡

| ç±»åˆ« | æ–‡ä»¶æ•°é‡ | æ ¸å¿ƒæç¤ºè¯æ•°é‡ |
|------|----------|---------------|
| é‡åŒ–åœºæ™¯æ ¸å¿ƒæç¤ºè¯ | 1 | 9 |
| é‡åŒ–ç¼–ç è§„èŒƒæç¤ºè¯ | 1 | 7 |
| é‡åŒ–ç¼–ç å™¨æç¤ºè¯ | 2 | 8 |
| é‡åŒ–ææ¡ˆç”Ÿæˆæç¤ºè¯ | 1 | 2 |
| é‡åŒ–åº”ç”¨å±‚æç¤ºè¯ | 1 | 1 |
| **æ€»è®¡** | **6ä¸ªæ–‡ä»¶** | **27ä¸ªæç¤ºè¯** |

### 5.2 é‡åŒ–åœºæ™¯æ ¸å¿ƒæç¤ºè¯ï¼ˆscenarios/qlib/prompts.yamlï¼‰

| æç¤ºè¯é”®å | æç¤ºè¯è¯´æ˜ | å¯¹ä»»åŠ¡æ¼”è¿›çš„å½±å“ | ä½¿ç”¨é˜¶æ®µ |
|-----------|-----------|-----------------|----------|
| `hypothesis_output_format` | å®šä¹‰å‡è®¾è¾“å‡ºçš„JSONæ ¼å¼ï¼Œè¦æ±‚ä½¿ç”¨ç®€ä½“ä¸­æ–‡ | **å½±å“å› å­/æ¨¡å‹æ–¹å‘**ï¼šå†³å®šäº†æ¯è½®è¿­ä»£çš„æ ¸å¿ƒç ”ç©¶æ–¹å‘ | å‡è®¾ç”Ÿæˆé˜¶æ®µ |
| `factor_hypothesis_specification` | å› å­å‡è®¾ç”Ÿæˆè§„èŒƒï¼ŒåŒ…æ‹¬æ•°é‡é™åˆ¶ã€å¤æ‚åº¦é€’å¢ã€æ•°æ®æºçº¦æŸç­‰ | **å½±å“å› å­å¤šæ ·æ€§**ï¼šç¡®ä¿å› å­ä»ç®€å•åˆ°å¤æ‚æ¼”è¿›ï¼Œé¿å…é‡å¤å¹³åº¸å› å­ | å‡è®¾ç”Ÿæˆé˜¶æ®µ |
| `model_hypothesis_specification` | æ¨¡å‹å‡è®¾ç”Ÿæˆè§„èŒƒï¼Œä¸“æ³¨äºPyTorchæ¨¡å‹æ¶æ„è®¾è®¡ | **å½±å“æ¨¡å‹åˆ›æ–°æ€§**ï¼šå¼•å¯¼æ¨¡å‹ä»ç®€å•æ¶æ„é€æ­¥æ¼”è¿›åˆ°åˆ›æ–°æ¶æ„ | å‡è®¾ç”Ÿæˆé˜¶æ®µ |
| `action_gen` | å†³ç­–ä¸‹ä¸€ä¸ªå®éªŒæ˜¯å…³æ³¨å› å­è¿˜æ˜¯æ¨¡å‹ | **å½±å“æ¼”è¿›è·¯å¾„**ï¼šæ ¹æ®å†å²ç»“æœåŠ¨æ€è°ƒæ•´ç ”å‘æ–¹å‘ | å†³ç­–é˜¶æ®µ |
| `factor_experiment_output_format` | å®šä¹‰å› å­å®éªŒè¾“å‡ºçš„JSONæ ¼å¼ | **å½±å“å› å­å®ç°**ï¼šå°†å‡è®¾è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„å› å­å®šä¹‰ | å®éªŒç”Ÿæˆé˜¶æ®µ |
| `model_experiment_output_format` | å®šä¹‰æ¨¡å‹å®éªŒè¾“å‡ºçš„JSONæ ¼å¼ | **å½±å“æ¨¡å‹å®ç°**ï¼šå°†å‡è®¾è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„æ¨¡å‹å®šä¹‰ | å®éªŒç”Ÿæˆé˜¶æ®µ |
| `factor_feedback_generation` | å› å­åé¦ˆç”Ÿæˆç³»ç»Ÿæç¤ºï¼Œåˆ†æå›æµ‹ç»“æœå¹¶æä¾›æ”¹è¿›å»ºè®® | **å½±å“å› å­è¿­ä»£**ï¼šæ ¹æ®ICã€æ”¶ç›Šã€å›æ’¤ç­‰æŒ‡æ ‡åˆ¤æ–­å› å­è´¨é‡ | åé¦ˆåˆ†æé˜¶æ®µ |
| `model_feedback_generation` | æ¨¡å‹åé¦ˆç”Ÿæˆç³»ç»Ÿæç¤ºï¼Œåˆ†æè®­ç»ƒæ—¥å¿—å’Œå›æµ‹ç»“æœ | **å½±å“æ¨¡å‹è¿­ä»£**ï¼šæ ¹æ®è®­ç»ƒçŠ¶æ€å’Œå›æµ‹ç»“æœåˆ¤æ–­æ¨¡å‹è´¨é‡ | åé¦ˆåˆ†æé˜¶æ®µ |
| `hypothesis_and_feedback` | å±•ç¤ºæ‰€æœ‰å†å²å®éªŒçš„å‡è®¾å’Œåé¦ˆ | **å½±å“å­¦ä¹ æœºåˆ¶**ï¼šè®©LLMä»å†å²æˆåŠŸ/å¤±è´¥ä¸­å­¦ä¹  | å…¨é˜¶æ®µ |

### 5.3 é‡åŒ–ç¼–ç è§„èŒƒæç¤ºè¯ï¼ˆscenarios/qlib/experiment/prompts.yamlï¼‰

| æç¤ºè¯é”®å | æç¤ºè¯è¯´æ˜ | å¯¹ä»»åŠ¡æ¼”è¿›çš„å½±å“ | ä½¿ç”¨é˜¶æ®µ |
|-----------|-----------|-----------------|----------|
| `qlib_factor_interface` â­ | **æ ¸å¿ƒçº¦æŸ**ï¼šå®šä¹‰å› å­ä»£ç çš„ç»Ÿä¸€æ¨¡æ¿ã€æ•°æ®åŠ è½½ã€å­—æ®µé‡å‘½åã€ç´¢å¼•å¤„ç†ã€è¾“å‡ºæ ¼å¼ç­‰ï¼ˆ140è¡Œï¼‰ | **å½±å“ç¼–ç æˆåŠŸç‡**ï¼šè¿™æ˜¯å› å­ç¼–ç é˜¶æ®µæœ€é‡è¦çš„æç¤ºè¯ï¼Œç›´æ¥å†³å®šä»£ç æ˜¯å¦ç¬¦åˆQlibæ¥å£è¦æ±‚ | å› å­ç¼–ç é˜¶æ®µ |
| `qlib_factor_strategy` | å¼ºè°ƒæ•°æ®å¤„ç†çš„æ³¨é‡Šè¦æ±‚ï¼Œè§£é‡Šç´¢å¼•ç»“æ„ã€è®¿é—®æ–¹å¼ã€æ•°æ®å½¢çŠ¶å˜åŒ– | **å½±å“ä»£ç å¯è¯»æ€§**ï¼šå¸®åŠ©LLMç†è§£æ¯ä¸€æ­¥æ“ä½œçš„æ•°æ®ç»“æ„å˜åŒ– | å› å­ç¼–ç é˜¶æ®µ |
| `qlib_factor_output_format` | å®šä¹‰è¾“å‡ºDataFrameçš„æ ¼å¼ï¼ŒåŒ…æ‹¬MultiIndexç´¢å¼•å’Œfloat32ç±»å‹ | **å½±å“è¾“å‡ºæ­£ç¡®æ€§**ï¼šç¡®ä¿è¾“å‡ºæ ¼å¼ç¬¦åˆQlibè¦æ±‚ | å› å­ç¼–ç é˜¶æ®µ |
| `qlib_factor_experiment_setting` | å®šä¹‰æ•°æ®é›†ã€æ¨¡å‹ã€å› å­ã€æ•°æ®åˆ†å‰²ç­‰å®éªŒè®¾ç½®ï¼Œä»¥åŠè®¡ç®—èµ„æºå»ºè®® | **å½±å“å®éªŒé…ç½®**ï¼šæŒ‡å¯¼è®­ç»ƒè½®æ•°ã€batchå¤§å°ã€å¹¶è¡Œåº¦ç­‰å‚æ•°è®¾ç½® | å®éªŒé…ç½®é˜¶æ®µ |
| `qlib_model_interface` | å®šä¹‰æ¨¡å‹ä»£ç çš„æ¥å£è§„èŒƒï¼ŒåŒ…æ‹¬ç±»ç»§æ‰¿ã€åˆå§‹åŒ–ã€forwardå‡½æ•°ç­‰ | **å½±å“ç¼–ç æˆåŠŸç‡**ï¼šç¡®ä¿æ¨¡å‹ä»£ç ç¬¦åˆPyTorchå’ŒQlibæ¥å£è¦æ±‚ | æ¨¡å‹ç¼–ç é˜¶æ®µ |
| `qlib_model_output_format` | å®šä¹‰æ¨¡å‹è¾“å‡ºçš„tensoræ ¼å¼å’Œä¿å­˜æ–¹å¼ | **å½±å“è¾“å‡ºæ­£ç¡®æ€§**ï¼šç¡®ä¿è¾“å‡ºæ ¼å¼ç¬¦åˆQlibè¦æ±‚ | æ¨¡å‹ç¼–ç é˜¶æ®µ |
| `qlib_model_experiment_setting` | å®šä¹‰æ¨¡å‹å®éªŒçš„æ•°æ®é›†ã€å› å­ã€æ•°æ®åˆ†å‰²ç­‰è®¾ç½® | **å½±å“å®éªŒé…ç½®**ï¼šæŒ‡å¯¼æ¨¡å‹è®­ç»ƒçš„å‚æ•°è®¾ç½® | å®éªŒé…ç½®é˜¶æ®µ |

### 5.4 é‡åŒ–ç¼–ç å™¨æç¤ºè¯

#### å› å­ç¼–ç å™¨ï¼ˆcomponents/coder/factor_coder/prompts.yamlï¼‰

| æç¤ºè¯é”®å | æç¤ºè¯è¯´æ˜ | å¯¹ä»»åŠ¡æ¼”è¿›çš„å½±å“ | ä½¿ç”¨é˜¶æ®µ |
|-----------|-----------|-----------------|----------|
| `evolving_strategy_factor_implementation_v1_system` | å› å­å®ç°çš„æ ¸å¿ƒç­–ç•¥ï¼ŒæŒ‡å¯¼LLMå¦‚ä½•åŸºäºåœºæ™¯ã€ç±»ä¼¼å› å­ã€å¤±è´¥ä»£ç åŠåé¦ˆç¼–å†™å› å­ä»£ç  | **å½±å“ç¼–ç è´¨é‡**ï¼šè¿™æ˜¯å› å­ç¼–ç çš„æ ¸å¿ƒæç¤ºè¯ | å› å­ç¼–ç é˜¶æ®µ |
| `evaluator_code_feedback_v1_system` | ä»£ç è¯„ä¼°æç¤ºè¯ï¼Œæ£€æŸ¥ä»£ç æ˜¯å¦ä¸å› å­å’Œåœºæ™¯å¯¹é½ | **å½±å“é”™è¯¯å‘ç°**ï¼šåŠæ—¶å‘ç°ä»£ç ä¸­çš„é€»è¾‘é”™è¯¯å’Œæ ¼å¼é—®é¢˜ | å› å­è¯„ä¼°é˜¶æ®µ |
| `evolving_strategy_error_summary_v2_system` | é”™è¯¯æ€»ç»“æç¤ºè¯ï¼Œä»ç±»ä¼¼é”™è¯¯ä¸­å­¦ä¹ å¹¶æä¾›æ”¹è¿›å»ºè®® | **å½±å“é”™è¯¯ä¿®å¤**ï¼šå¸®åŠ©LLMä»å†å²é”™è¯¯ä¸­å­¦ä¹  | é”™è¯¯ä¿®å¤é˜¶æ®µ |
| `select_implementable_factor_system` | å› å­é€‰æ‹©æç¤ºè¯ï¼Œåˆ†æå› å­éš¾åº¦å¹¶ç­›é€‰å¯å®ç°çš„å› å­ | **å½±å“ä»»åŠ¡ç­›é€‰**ï¼šé¿å…å°è¯•éš¾ä»¥å®ç°çš„å› å­ | ä»»åŠ¡ç­›é€‰é˜¶æ®µ |
| `evaluator_final_decision_v1_system` | æœ€ç»ˆå†³ç­–æç¤ºè¯ï¼Œåˆ¤æ–­å› å­æ˜¯å¦å®ç°æ­£ç¡® | **å½±å“è¿­ä»£ç»ˆæ­¢**ï¼šå†³å®šæ˜¯å¦è¿›å…¥ä¸‹ä¸€è½®è¿­ä»£ | æœ€ç»ˆå†³ç­–é˜¶æ®µ |

#### æ¨¡å‹ç¼–ç å™¨ï¼ˆcomponents/coder/model_coder/prompts.yamlï¼‰

| æç¤ºè¯é”®å | æç¤ºè¯è¯´æ˜ | å¯¹ä»»åŠ¡æ¼”è¿›çš„å½±å“ | ä½¿ç”¨é˜¶æ®µ |
|-----------|-----------|-----------------|----------|
| `evolving_strategy_model_coder` | æ¨¡å‹å®ç°çš„æ ¸å¿ƒç­–ç•¥ï¼ŒæŒ‡å¯¼LLMå¦‚ä½•åŸºäºåœºæ™¯ã€ç±»ä¼¼æ¨¡å‹ã€å¤±è´¥ä»£ç åŠåé¦ˆç¼–å†™æ¨¡å‹ä»£ç  | **å½±å“ç¼–ç è´¨é‡**ï¼šè¿™æ˜¯æ¨¡å‹ç¼–ç çš„æ ¸å¿ƒæç¤ºè¯ | æ¨¡å‹ç¼–ç é˜¶æ®µ |
| `evaluator_code_feedback` | ä»£ç è¯„ä¼°æç¤ºè¯ï¼Œæ£€æŸ¥ä»£ç æ˜¯å¦ä¸æ¨¡å‹ä¿¡æ¯å’Œåœºæ™¯å¯¹é½ | **å½±å“é”™è¯¯å‘ç°**ï¼šåŠæ—¶å‘ç°ä»£ç ä¸­çš„é€»è¾‘é”™è¯¯å’Œæ ¼å¼é—®é¢˜ | æ¨¡å‹è¯„ä¼°é˜¶æ®µ |
| `evaluator_final_feedback` | æœ€ç»ˆåé¦ˆæç¤ºè¯ï¼Œåˆ¤æ–­æ¨¡å‹æ˜¯å¦å®ç°æ­£ç¡® | **å½±å“è¿­ä»£ç»ˆæ­¢**ï¼šå†³å®šæ˜¯å¦è¿›å…¥ä¸‹ä¸€è½®è¿­ä»£ | æœ€ç»ˆå†³ç­–é˜¶æ®µ |

### 5.5 é‡åŒ–åœºæ™¯RD Loopå®Œæ•´æµç¨‹

```
1. ã€å‡è®¾ç”Ÿæˆé˜¶æ®µã€‘
   â”œâ”€ components/proposal/prompts.yaml (hypothesis_gen)
   â”œâ”€ app/qlib_rd_loop/prompts.yaml (hypothesis_generation)
   â””â”€ scenarios/qlib/prompts.yaml (hypothesis_output_format)

2. ã€å®éªŒç”Ÿæˆé˜¶æ®µã€‘
   â”œâ”€ components/proposal/prompts.yaml (hypothesis2experiment)
   â”œâ”€ scenarios/qlib/prompts.yaml (factor_experiment_output_format)
   â””â”€ scenarios/qlib/prompts.yaml (model_experiment_output_format)

3. ã€ä»»åŠ¡åˆ†è§£é˜¶æ®µã€‘
   â””â”€ components/coder/CoSTEER/prompts.yaml (analyze_component_prompt_v1_system)

4. ã€å› å­ç¼–ç é˜¶æ®µã€‘âš ï¸ å…³é”®ç“¶é¢ˆ
   â”œâ”€ scenarios/qlib/experiment/prompts.yaml (qlib_factor_interface) â­ æœ€é‡è¦
   â”œâ”€ components/coder/factor_coder/prompts.yaml (evolving_strategy_factor_implementation)
   â”œâ”€ components/coder/factor_coder/prompts.yaml (evaluator_code_feedback)
   â”œâ”€ components/coder/factor_coder/prompts.yaml (evolving_strategy_error_summary)
   â””â”€ components/coder/factor_coder/prompts.yaml (evaluator_final_decision)

5. ã€æ¨¡å‹ç¼–ç é˜¶æ®µã€‘
   â”œâ”€ scenarios/qlib/experiment/prompts.yaml (qlib_model_interface)
   â”œâ”€ components/coder/model_coder/prompts.yaml (evolving_strategy_model_coder)
   â”œâ”€ components/coder/model_coder/prompts.yaml (evaluator_code_feedback)
   â””â”€ components/coder/model_coder/prompts.yaml (evaluator_final_feedback)

6. ã€åé¦ˆåˆ†æé˜¶æ®µã€‘
   â”œâ”€ scenarios/qlib/prompts.yaml (factor_feedback_generation)
   â”œâ”€ scenarios/qlib/prompts.yaml (model_feedback_generation)
   â””â”€ scenarios/qlib/prompts.yaml (action_gen)
```

### 5.6 é‡åŒ–åœºæ™¯æç¤ºè¯ä¼˜å…ˆçº§åˆ†æ

#### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç›´æ¥å½±å“ç¼–ç æˆåŠŸç‡ï¼‰

| æç¤ºè¯ | æ–‡ä»¶ | é—®é¢˜ | ä¼˜åŒ–æ½œåŠ› |
|--------|------|------|----------|
| `qlib_factor_interface` | `scenarios/qlib/experiment/prompts.yaml` | ä¿¡æ¯è¿‡è½½ï¼ˆ140è¡Œæ ¸å¿ƒçº¦æŸï¼‰ã€ç¼ºå°‘é”™è¯¯é¢„é˜² | **æé«˜**ï¼šæ‹†åˆ†åé¢„è®¡å‡å°‘35-48%çš„codingè½®æ•° |
| `evolving_strategy_factor_implementation` | `components/coder/factor_coder/prompts.yaml` | ä¸­è‹±æ–‡æ··ç”¨ã€è‚¡ç¥¨ä»£ç æ ¼å¼è¯´æ˜åˆ†æ•£ | **é«˜**ï¼šç»Ÿä¸€è¯­è¨€åæé«˜ç†è§£åº¦ |

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå½±å“æ–¹å‘å’Œè´¨é‡ï¼‰

| æç¤ºè¯ | æ–‡ä»¶ | é—®é¢˜ | ä¼˜åŒ–æ½œåŠ› |
|--------|------|------|----------|
| `factor_hypothesis_specification` | `scenarios/qlib/prompts.yaml` | æ•°æ®æºçº¦æŸè¯´æ˜è¾ƒé•¿ | **ä¸­**ï¼šç®€åŒ–åæé«˜å‡è®¾ç”Ÿæˆæ•ˆç‡ |
| `factor_feedback_generation` | `scenarios/qlib/prompts.yaml` | å®ç°çº¦æŸè§„åˆ™é‡å¤ | **ä¸­**ï¼šç²¾ç®€åæé«˜åé¦ˆè´¨é‡ |
| `model_hypothesis_specification` | `scenarios/qlib/prompts.yaml` | æ¶æ„åˆ›æ–°å¼•å¯¼ä¸å¤Ÿæ˜ç¡® | **ä¸­**ï¼šå¢å¼ºåæé«˜æ¨¡å‹åˆ›æ–°æ€§ |

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆè¾…åŠ©æ€§æç¤ºè¯ï¼‰

| æç¤ºè¯ | æ–‡ä»¶ | é—®é¢˜ | ä¼˜åŒ–æ½œåŠ› |
|--------|------|------|----------|
| `qlib_factor_strategy` | `scenarios/qlib/experiment/prompts.yaml` | åŒ…å«é”™è¯¯å¼•å¯¼ï¼ˆreset_indexç¤ºä¾‹ï¼‰ | **ä½**ï¼šä¿®å¤åå‡å°‘ç´¢å¼•é”™è¯¯ |
| `qlib_model_interface` | `scenarios/qlib/experiment/prompts.yaml` | è§„èŒƒæ¸…æ™° | **ä½**ï¼šä¿æŒç°çŠ¶ |
| `action_gen` | `scenarios/qlib/prompts.yaml` | åŠŸèƒ½æ˜ç¡® | **ä½**ï¼šä¿æŒç°çŠ¶ |

---

## å…­ã€æ€»ç»“

### æ ¸å¿ƒå‘ç°

1. **ä¿¡æ¯è¿‡è½½æ˜¯æœ€å¤§é—®é¢˜**ï¼š`qlib_factor_interface`é•¿è¾¾464è¡Œï¼Œå…³é”®çº¦æŸè¢«æ·¹æ²¡
2. **ç¼ºå°‘é”™è¯¯é¢„é˜²**ï¼šæ²¡æœ‰é’ˆå¯¹groupby+rollingã€åˆ—åæ··æ·†ç­‰å¸¸è§é”™è¯¯çš„é¢„é˜²æªæ–½
3. **çº¦æŸä¸ä¸€è‡´**ï¼štry-exceptä½¿ç”¨ã€è¾“å‡ºæ ¼å¼ç­‰åœ¨ä¸åŒæç¤ºè¯ä¸­è¦æ±‚ä¸ä¸€è‡´
4. **è¯­è¨€æ··ç”¨**ï¼šä¸­è‹±æ–‡æ··ç”¨ï¼Œå¯¼è‡´LLMè¾“å‡ºè¯­è¨€ä¸ä¸€è‡´
5. **å†—ä½™å†…å®¹**ï¼šåŒ…å«å¤§é‡ä¸å› å­ç¼–ç æ— å…³çš„æ¨¡å‹è®­ç»ƒã€ç­–ç•¥æ¼”è¿›ä¿¡æ¯

### ä¿®æ”¹å»ºè®®

1. **æ‹†åˆ†æç¤ºè¯**ï¼šå°†æ ¸å¿ƒçº¦æŸã€é”™è¯¯é¢„é˜²ã€ç¤ºä¾‹æ‹†åˆ†ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼ˆæ¨èä½¿ç”¨YAML includeæœºåˆ¶ï¼‰
2. **æ·»åŠ é”™è¯¯é¢„é˜²**ï¼šé’ˆå¯¹å¸¸è§é”™è¯¯æä¾›é”™è¯¯ç¤ºä¾‹å’Œæ­£ç¡®ç¤ºä¾‹çš„å¯¹æ¯”
3. **ç»Ÿä¸€çº¦æŸè§„èŒƒ**ï¼šåˆ¶å®šç»Ÿä¸€çš„çº¦æŸæ–‡æ¡£ï¼Œç¡®ä¿æ‰€æœ‰æç¤ºè¯ä¸€è‡´
4. **ç»Ÿä¸€è¯­è¨€è§„èŒƒ**ï¼šä»£ç æ³¨é‡Šç”¨ä¸­æ–‡ï¼Œå˜é‡åç”¨è‹±æ–‡ï¼Œè¾“å‡ºè¯´æ˜ç”¨ä¸­æ–‡
5. **ç§»é™¤å†—ä½™å†…å®¹**ï¼šåªä¿ç•™ä¸å½“å‰ä»»åŠ¡ç›¸å…³çš„ä¿¡æ¯

### é¢„æœŸæ•ˆæœ

é€šè¿‡å®æ–½ä¸Šè¿°ä¿®æ”¹ï¼Œé¢„è®¡å¯ä»¥ï¼š
- å°†å¹³å‡codingè½®æ•°ä»6.2è½®é™è‡³3-4è½®
- å°†éœ€è¦10è½®çš„ä»»åŠ¡æ¯”ä¾‹ä»43.5%é™è‡³15-20%
- æå‡ä»£ç è´¨é‡å’Œä¸€è‡´æ€§
- å‡å°‘LLMå›°æƒ‘å’Œé”™è¯¯å¼•å¯¼

### å…³äºæ‹†åˆ†æç¤ºè¯çš„å»ºè®®

**æ˜¯å¦éœ€è¦æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼Ÿ**

**æ¨èæ–¹æ¡ˆï¼šæ˜¯ï¼Œä½¿ç”¨YAML includeæœºåˆ¶æ‹†åˆ†**

**åŸå› **ï¼š
1. **æ¨¡å—åŒ–ç¨‹åº¦é«˜**ï¼šæ ¸å¿ƒçº¦æŸã€é”™è¯¯é¢„é˜²ã€ç¤ºä¾‹å¯ä»¥ç‹¬ç«‹ç»´æŠ¤å’Œå¤ç”¨
2. **çµæ´»ç»„åˆ**ï¼šå¯ä»¥åœ¨ä¸åŒæç¤ºè¯ä¸­çµæ´»ç»„åˆä¸åŒçš„æ¨¡å—
3. **ä¾¿äºæµ‹è¯•**ï¼šå¯ä»¥å•ç‹¬æµ‹è¯•å’ŒéªŒè¯æ¯ä¸ªæ¨¡å—çš„æ­£ç¡®æ€§
4. **å®ç°ç®€å•**ï¼šYAMLåŸç”Ÿæ”¯æŒincludeæœºåˆ¶ï¼Œæ— éœ€é¢å¤–å¼€å‘
5. **æ˜“äºæ‰©å±•**ï¼šæœªæ¥æ·»åŠ æ–°çš„çº¦æŸæˆ–ç¤ºä¾‹æ—¶ï¼Œåªéœ€æ·»åŠ æ–°æ–‡ä»¶

**å»ºè®®çš„æ–‡ä»¶ç»“æ„**ï¼š
```
rdagent/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ coder/
â”‚       â””â”€â”€ factor_coder/
â”‚           â”œâ”€â”€ prompts.yaml                    # ä¸»æç¤ºè¯ï¼ˆç»„åˆå„æ¨¡å—ï¼‰
â”‚           â”œâ”€â”€ prompts_core_constraints.yaml   # æ ¸å¿ƒçº¦æŸ
â”‚           â”œâ”€â”€ prompts_error_prevention.yaml   # é”™è¯¯é¢„é˜²
â”‚           â”œâ”€â”€ prompts_examples.yaml           # å®Œæ•´ç¤ºä¾‹
â”‚           â””â”€â”€ prompts_language_spec.yaml      # è¯­è¨€è§„èŒƒ
```

**ç¤ºä¾‹ç”¨æ³•**ï¼š
```yaml
# prompts.yaml
qlib_factor_interface: |-
  {% include "factor_coder.prompts_core_constraints:factor_coder_core_constraints" %}
  {% include "factor_coder.prompts_error_prevention:factor_coder_error_prevention" %}
  {% include "factor_coder.prompts_examples:factor_coder_examples" %}
  {% include "factor_coder.prompts_language_spec:factor_coder_language_spec" %}
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-09  
**åˆ†æå·¥å…·**: Cascade  
**ä¸‹ä¸€æ­¥**: æ ¹æ®ä¼˜å…ˆçº§é€æ­¥å®æ–½ä¿®æ”¹å»ºè®®
