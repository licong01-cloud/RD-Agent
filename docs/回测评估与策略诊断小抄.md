# 回测评估与策略诊断小抄（草案）

> 版本：v0.1  
> 作用：为 LLM 和研究者提供一份精简的“看回测结果时应该关注什么”的 checklist，辅助 RD-Agent 在生成反馈和下一轮改进建议时更像人类 Quant Review。

---

## 1. 关键绩效指标（KPIs）

### 1.1 收益相关

- **年化收益率（Annualized Return）**：
  - 衡量长期收益水平，需结合回测区间长度理解；
  - 在当前 AIstock 场景中，一般希望年化 > 10%。

- **累计收益曲线**：
  - 是否平滑向上，是否存在“集中在少数几个时段”的收益集中现象。

### 1.2 风险相关

- **最大回撤（Max Drawdown）**：
  - 单个或多个时间窗口内的最大资金回撤幅度；
  - 当前场景中通常希望组合 max drawdown ≤ 10% 左右。

- **波动率（Volatility）**：
  - 组合收益的标准差或年化波动率；
  - 与收益水平结合看 Sharpe/Sortino 等。

### 1.3 风险调整收益

- **Sharpe Ratio**：
  - \( Sharpe = \frac{R_p - R_f}{\sigma_p} \)；
  - 在无风险利率接近 0 时，可近似为 `年化收益 / 年化波动率`。

- **信息比率 / IC、Rank IC**：
  - 对于因子级别评估，IC/Rank IC 越稳定越好；
  - 注意样本外时段的 IC 是否显著下降或反向。

---

## 2. 交易与风格特征

### 2.1 换手率与交易成本

- **日均换手率、月度换手率**：
  - 换手过高的策略，即使毛收益不错，扣除成本后可能没有超额收益；
- **交易成本假设**：
  - 买卖双边成本、滑点设定，应在 Qlib 配置中明确；
  - LLM 评估时需说明：在给定成本假设下，该策略的净收益情况。

### 2.2 行业/市值/风格暴露

- **行业集中度**：
  - 收益是否主要来自少数几个行业；
- **市值暴露**：
  - 是否过度偏向小盘或大盘；
- **风格因子暴露**：
  - 如动量、价值、成长、波动率、流动性等风险因子。

---

## 3. 常见“假好策略”特征

### 3.1 过拟合 / 噪声型策略

- 样本内表现很好，样本外（特别是最近几年）表现显著变差；
- 收益高度集中在少数历史阶段，其余时间接近平或亏损；
- 对某些极端个股/极端行情高度依赖（例如只在少数几次牛市期间赚钱）。

### 3.2 交易不可行的策略

- 极端高换手率，且集中在流动性较差的小票上；
- 大量信号落在涨停/跌停板附近，实际成交概率很低；
- 策略在理论上要求 T+0，但市场只能 T+1。

### 3.3 风险失控的策略

- 年化收益尚可，但最大回撤极大；
- 收益曲线呈明显“长尾风险”：大部分时间小赚小亏，偶尔一次巨大亏损吃掉多年利润；
- 仓位集中在少数个股，缺乏分散化。

---

## 4. RD-Agent 演进场景下的诊断思路

### 4.1 单轮内实验比较

- 对同一轮中的多个实验：
  - 对比它们的年化、max drawdown、Sharpe；
  - 分析：改动的是因子、模型还是参数？哪一类改动带来的收益/风险变化更明显？

### 4.2 跨轮演进趋势

- 观察多轮结果：
  - 是否在某些方向（例如更复杂模型）上出现收益提高但回撤也同步放大？
  - 是否在某些因子组合上 IC 稳定但收益不佳，可能受到交易成本或行业暴露限制？

### 4.3 失败实验的价值

- 对于明显失败的实验（收益低 / 回撤大 / 无法交易）：
  - 记录其共性（例如超高换手、过度集中于低价股等）；
  - 在下一轮生成策略/因子时，显式提醒 LLM 避免类似特征。

---

## 5. 对 LLM 的输出建议

在 RD-Agent 的回测评估/策略诊断任务中，LLM 应：

1. 先用 2–3 句话**客观总结关键指标**（年化、max drawdown、Sharpe、IC 等）；
2. 再用 2–3 句话**指出最主要的问题**（例如回撤过大、收益集中、换手率过高等）；
3. 最后提出 1–2 条**具体改进方向**（例如：
   - 在保持因子不变的前提下，收紧持仓数量/行业暴露；
   - 引入流动性过滤或换手率惩罚；
   - 考虑用更稳健的模型结构替换当前过拟合风险高的模型）。

LLM 不需要给出完全正确的量化结论，但应表现出：

- 能读懂关键指标；
- 能从结果中抽象出“问题模式”；
- 能给出与这些问题模式相匹配的合理改进建议。
