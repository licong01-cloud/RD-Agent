# RD-Agent 根目录 Python 文件整理报告

**生成时间**: 2026-01-13  
**整理目的**: 将根目录下的 Python 脚本分类整理，区分正式工具和临时调试脚本

---

## 一、文件移动操作记录

### 1.1 移动到 debug_tools/ 的文件（共 137 个）

#### A. analyze_* 系列分析脚本（20 个）
```
analyze_aistock_h5_inf.py
analyze_coding_errors.py
analyze_coding_errors_v2.py
analyze_coding_errors_v3.py
analyze_error_pattern.py
analyze_error_patterns.py
analyze_evo_loop_distribution.py
analyze_factor_errors.py
analyze_factor_errors_v2.py
analyze_h5_export_range.py
analyze_hypothesis_actions.py
analyze_inf_records.py
analyze_llm_errors.py
analyze_nav_anomaly.py
analyze_pickle_structure.py
analyze_system_prompts.py
analyze_trading_days.py
analyze_unit_mismatch.py
```

#### B. check_* 系列检查脚本（80 个）
```
check_20210406_anomaly.py
check_aistock_h5_anomalies.py
check_anomaly_date_distribution.py
check_anomaly_date_distribution_detail.py
check_anomaly_stock_distribution.py
check_anomaly_stocks_debug.py
check_anomaly_stocks_final.py
check_anomaly_stocks_final_v3.py
check_anomaly_stocks_list.py
check_anomaly_stocks_logic_difference.py
check_anomaly_stocks_prefix.py
check_anomaly_stocks_prefix_final.py
check_anomaly_stocks_range.py
check_anomaly_stocks_recheck.py
check_batch_3_4_logic.py
check_bin_factor_column.py
check_coding_pkl.py
check_csv_bin_export_anomaly.py
check_csv_factor_column.py
check_csv_structure.py
check_debug_h5_anomalies.py
check_error_chuangyeboard_stocks.py
check_error_stocks_characteristics.py
check_error_stocks_date_range.py
check_error_stocks_full_data.py
check_error_stocks_full_list.py
check_error_stocks_h5_data.py
check_error_stocks_prefix.py
check_evo_loop_pkl.py
check_export_script_anomaly_debug.py
check_factor_distribution.py
check_feedback_pkl.py
check_git_status.py
check_h5_anomaly_distribution.py
check_h5_anomaly_distribution_v2.py
check_h5_anomaly_stocks_data.py
check_h5_columns.py
check_h5_export_time.py
check_h5_factor_column.py
check_h5_metadata.py
check_hypothesis_log.py
check_hypothesis_log2.py
check_llm_output.py
check_logger_debug.py
check_loop6_result.py
check_loop7_hypothesis.py
check_loop7_hypothesis2.py
check_loop8_experiment.py
check_loop8_experiment2.py
check_loop8_hypothesis.py
check_loop9_hypothesis.py
check_models.py
check_other_h5_anomaly.py
check_parquet_anomaly.py
check_partial_anomaly_stocks.py
check_pkl_structure.py
check_positions_structure.py
check_prompt_keys.py
check_qlib_bin_wsl.py
check_qlib_data.py
check_rdagent_config.py
check_syntax.py
check_task_types.py
check_zero_factor_mask_logic.py
check_zero_factor_mask_logic_debug.py
```

#### C. confirm_* 系列确认脚本（5 个）
```
confirm_anomaly_stocks_count.py
confirm_anomaly_stocks_count_v2.py
```

#### D. debug_* 系列调试脚本（6 个）
```
debug_compile.py
debug_dataset_pipeline.py
debug_instruments.py
debug_nan.py
debug_positions.py
debug_qlib_features.py
```

#### E. diagnose_* 系列诊断脚本（5 个）
```
diagnose_h5_issue.py
diagnose_import.py
diagnose_sqlite.py
diagnose_syntax.py
diagnose_v2.py
```

#### F. final_confirm_* 系列最终确认脚本（5 个）
```
final_confirm_anomaly_stocks.py
final_confirm_anomaly_stocks_latest.py
final_confirm_anomaly_stocks_latest_v2.py
final_confirm_anomaly_stocks_precise.py
final_confirm_anomaly_stocks_simple.py
```

#### G. 其他调试脚本（16 个）
```
compare_daily_pv_h5.py
compare_git_files.py
convert_ae_factor_h5_to_parquet.py
deep_inspect_pkl.py
detailed_analysis.py
detailed_profit_analysis.py
diagnose_cash_in_positions.py
factor_ae_recon_error_10d.py
inspect_qlib_env.py
investigate_positions.py
llm_speed_compare.py
precompute_daily_basic_factors.py
precompute_moneyflow_factors.py
prepare_all_data.py
prepare_data_from_aistock.py
prepare_minimal_data.py
reconfirm_anomaly_stocks.py
reconfirm_anomaly_stocks_final.py
regenerate_debug_dataset.py
repair_h5_data.py
run_fin_quant_safe.py
sync_all_to_aistock.py
test_custom_strategy.py
test_embedding_batch.py
test_load_qlib_daily_data.py
test_load_qlib_daily_data_all.py
test_load_qlib_daily_data_all_columns.py
test_load_qlib_daily_data_all_direct.py
test_qlib_official_cn_data.py
test_qlib_snapshot.py
test_qlib_snapshot_official_style.py
test_sync_factor.py
train_ae_10d.py
validate_h5_on_startup.py
verify_utils_nan.py
```

### 1.2 复制到 tools/ 的文件（共 10 个）

这些是 Qlib 回测分析工具，保留在根目录作为正式工具：

```
analyze_backtest_result.py       - 回测结果分析
analyze_bundles.py              - bundles 文件分布分析
analyze_bundles_detailed.py     - bundles 详细分析
analyze_cash_curve.py           - 资金曲线分析
analyze_qlib_backtest.py        - Qlib 回测交易记录详细分析
analyze_qlib_backtest_fixed.py  - Qlib 回测分析（修正版）
analyze_qlib_records.py         - Qlib 回测记录分析
analyze_score_distribution.py   - 评分分布分析
analyze_trade_performance.py    - 交易表现分析
analyze_trades.py               - 交易记录分析
```

---

## 二、文件分类分析

### 2.1 临时调试脚本（debug_tools/）

**特征识别标准**:
1. 文件名包含 `check_`, `debug_`, `diagnose_`, `test_`, `analyze_`（非回测相关）
2. 代码中硬编码了特定路径或实验 ID
3. 用于一次性问题诊断或数据检查
4. 不包含在 RD-Agent 核心流程中

**分类结果**:
- **数据异常检查类** (35 个): 检查 H5 文件、CSV 文件、数据导出异常
- **编码错误分析类** (5 个): 分析 coding 阶段的失败原因
- **LLM 调用分析类** (3 个): 分析 LLM 输出、系统提示词
- **Hypothesis 分析类** (4 个): 分析 Hypothesis 生成和 action 切换
- **Loop 日志检查类** (10 个): 检查特定 loop 的 pkl 文件
- **数据准备类** (8 个): 数据预处理、因子预计算
- **测试脚本类** (15 个): 测试 Qlib 数据加载、策略运行
- **诊断脚本类** (5 个): 诊断导入、语法、SQLite 问题
- **其他工具类** (52 个): 各种临时调试工具

### 2.2 正式工具（tools/）

**特征识别标准**:
1. 文件名包含 `analyze_*`（回测相关）
2. 用于分析 Qlib 回测结果
3. 可重复使用，不依赖特定实验
4. 提供标准化的分析报告

**分类结果**:
- **回测结果汇总类** (2 个): analyze_backtest_result.py, analyze_qlib_records.py
- **资金曲线分析类** (1 个): analyze_cash_curve.py
- **交易表现分析类** (2 个): analyze_trade_performance.py, analyze_trades.py
- **持仓分析类** (1 个): analyze_qlib_backtest.py, analyze_qlib_backtest_fixed.py
- **评分分析类** (1 个): analyze_score_distribution.py
- **Bundles 分析类** (2 个): analyze_bundles.py, analyze_bundles_detailed.py

### 2.3 RD-Agent 必要文件（根目录剩余）

**当前状态**: 根目录已无剩余 Python 文件

**说明**: 
- 所有 Qlib 回测分析工具已复制到 `tools/` 目录
- 所有临时调试脚本已移动到 `debug_tools/` 目录
- `debug_tools/` 目录已在 `.gitignore` 中配置为忽略

---

## 三、整理前后对比

### 3.1 整理前
- 根目录 Python 文件总数: **147 个**
- 正式工具: **10 个**（混杂在根目录）
- 临时调试脚本: **137 个**（混杂在根目录）

### 3.2 整理后
- 根目录 Python 文件总数: **0 个**
- `tools/` 目录正式工具: **10 个**（已复制）
- `debug_tools/` 目录临时脚本: **137 个**（已移动）

---

## 四、文件清单详情

### 4.1 debug_tools/ 目录结构

```
debug_tools/
├── 2025-12-21/
│   ├── analyze_factor_run_logs.py
│   ├── analyze_rdloop_qlib_log.py
│   ├── finr1_coding_eval.py
│   ├── inspect_dynamic_factors_parquet.py
│   ├── llm_speed_compare.py
│   └── scan_dynamic_parquets_wsl.py
├── 2025-12-22/
│   └── export_best_quant_artifact.py
├── exports/
│   ├── export_20251222_134904_multi/
│   ├── export_20251222_135023_ic/
│   └── export_20251222_135403_return/
├── upstream_audit/
│   ├── analyze_absent_11.py
│   ├── export_absent_11.py
│   ├── generate_upstream_commit_audit.py
│   ├── incremental_upstream_audit.py
│   ├── merge_parent_analysis.py
│   ├── UPSTREAM_BASELINE_MAIN.txt
│   ├── absent_11.md
│   ├── absent_11.tsv
│   ├── incremental_audit.md
│   ├── incremental_audit.tsv
│   ├── merge_parents_analysis.md
│   ├── merge_parents_analysis.tsv
│   ├── upstream_commit_audit.md
│   ├── upstream_commit_audit.tsv
│   ├── upstream_commit_audit_with_presence.md
│   ├── upstream_commit_audit_with_presence.tsv
│   └── verification.md
├── README.local.md
└── [137 个移动的 Python 脚本]
```

### 4.2 tools/ 目录结构

```
tools/
├── README.md                          # 工具使用文档
├── [原有的工具脚本]
└── [10 个复制的 Qlib 回测分析工具]
    ├── analyze_backtest_result.py
    ├── analyze_bundles.py
    ├── analyze_bundles_detailed.py
    ├── analyze_cash_curve.py
    ├── analyze_qlib_backtest.py
    ├── analyze_qlib_backtest_fixed.py
    ├── analyze_qlib_records.py
    ├── analyze_score_distribution.py
    ├── analyze_trade_performance.py
    └── analyze_trades.py
```

---

## 五、操作说明

### 5.1 为什么 debug_tools/ 目录没有立即显示文件？

**原因**: 
1. 之前使用的 `mv` 命令（Linux 风格）在 Windows PowerShell 中可能没有正确执行
2. 文件实际上没有被移动，仍然保留在根目录
3. 后续改用 `Move-Item` cmdlet（Windows 原生命令）成功移动了所有文件

### 5.2 Git 忽略配置

`.gitignore` 中已包含：
```
# debug_tools
debug_tools/
```

因此 `debug_tools/` 目录及其所有内容不会被提交到 Git 仓库。

### 5.3 使用建议

**正式工具（tools/）**:
- 这些工具可以长期保留和使用
- 建议定期更新文档（`tools/README.md`）
- 可以提交到 Git 仓库

**临时调试脚本（debug_tools/）**:
- 这些脚本用于临时问题诊断
- 不会提交到 Git 仓库
- 建议定期清理不再使用的脚本
- 可以按日期或问题类型组织到子目录中

---

## 六、验证结果

### 6.1 根目录 Python 文件数量
- 整理前: 147 个
- 整理后: 0 个

### 6.2 debug_tools/ 目录 Python 文件数量
- 直接移动: 137 个
- 子目录中: 6 个（2025-12-21/ 5 个，2025-12-22/ 1 个）
- upstream_audit/: 5 个
- **总计**: 148 个

### 6.3 tools/ 目录 Python 文件数量
- 原有工具: 约 80 个
- 新增复制: 10 个
- **总计**: 约 90 个

---

## 七、后续建议

1. **定期清理 debug_tools/**: 定期检查并删除不再需要的调试脚本
2. **文档维护**: 保持 `tools/README.md` 的更新，记录工具的使用方法和参数
3. **脚本分类**: 可以将 debug_tools/ 中的脚本按功能分类到子目录中
4. **路径配置**: 建议将硬编码的路径改为配置文件或命令行参数，提高脚本的可重用性

---

**报告生成完成时间**: 2026-01-13  
**整理状态**: ✅ 完成
