# 备份状态确认

**备份日期**: 2026-01-10
**备份目的**: 确保修改提示词后可以回退到当前状态

---

## 备份文件清单

### 因子研发阶段提示词备份

| 文件 | 备份文件 | 状态 |
|------|---------|------|
| `rdagent/scenarios/qlib/experiment/prompts.yaml` | `prompts.yaml.backup_20260109` | ✅ 已存在 |
| `rdagent/scenarios/qlib/experiment/prompts_core_constraints.yaml` | 无（新文件，无需备份） | N/A |
| `rdagent/scenarios/qlib/experiment/prompts_data_loading.yaml` | 无（新文件，无需备份） | N/A |
| `rdagent/scenarios/qlib/experiment/prompts_error_prevention.yaml` | 无（新文件，无需备份） | N/A |
| `rdagent/scenarios/qlib/experiment/prompts_dataset_info.yaml` | 无（新文件，无需备份） | N/A |
| `rdagent/scenarios/qlib/experiment/prompts_language_spec.yaml` | 无（新文件，无需备份） | N/A |

### 因子审核阶段提示词备份

| 文件 | 备份文件 | 状态 |
|------|---------|------|
| `rdagent/components/coder/factor_coder/prompts.yaml` | `prompts.yaml.backup_20260110` | ✅ 已创建 |

---

## 恢复方法

### 恢复因子研发阶段提示词

```bash
# 恢复 prompts.yaml
cp rdagent/scenarios/qlib/experiment/prompts.yaml.backup_20260109 rdagent/scenarios/qlib/experiment/prompts.yaml

# 删除新增的模块文件（如果需要完全恢复）
rm rdagent/scenarios/qlib/experiment/prompts_core_constraints.yaml
rm rdagent/scenarios/qlib/experiment/prompts_data_loading.yaml
rm rdagent/scenarios/qlib/experiment/prompts_error_prevention.yaml
rm rdagent/scenarios/qlib/experiment/prompts_dataset_info.yaml
rm rdagent/scenarios/qlib/experiment/prompts_language_spec.yaml
```

### 恢复因子审核阶段提示词

```bash
# 恢复 factor_coder/prompts.yaml
cp rdagent/components/coder/factor_coder/prompts.yaml.backup_20260110 rdagent/components/coder/factor_coder/prompts.yaml
```

---

## 修改范围确认

### 因子研发阶段提示词修改（`prompts.yaml`）

| 提示词 | 修改内容 | 是否影响审核 |
|--------|---------|-------------|
| `qlib_factor_strategy` | 修复 `reset_index()` 错误引导 | ❌ 否 |
| `qlib_factor_experiment_setting` | 精简，移除训练参数和策略演进 | ❌ 否 |
| `qlib_factor_simulator` | 暂不修改 | ❌ 否 |
| `transformer_volume_price_strategy` | 删除 | ❌ 否 |

### 因子审核阶段提示词修改（`factor_coder/prompts.yaml`）

| 提示词 | 修改内容 | 是否影响其他 |
|--------|---------|-------------|
| `evolving_strategy_factor_implementation_v1_system` | 简化股票代码格式说明（第45-50行） | ❌ 否 |

---

## 股票代码格式说明统一方案

### 当前重复位置

| 位置 | 行号 | 操作 |
|------|------|------|
| `prompts_data_loading.yaml` | 全文 | ✅ 保留（核心约束） |
| `qlib_factor_experiment_setting` | 185-187 | ❌ 删除 |
| `qlib_model_experiment_setting` | 315-317 | ❌ 删除 |
| `evolving_strategy_factor_implementation_v1_system` | 45-50 | ✅ 简化保留 |

### 统一措辞

```yaml
**股票代码格式**：
- 所有数据源中的 `instrument` 均已统一为 Qlib 风格（如 `000001.SZ`, `600000.SH`）
- **禁止**在因子脚本中进行任何形式的格式转换逻辑
```

---

## 回退确认

✅ **备份完成**
- `prompts.yaml.backup_20260109` 存在
- `prompts.yaml.backup_20260110` 存在

✅ **恢复方法明确**
- 可以通过复制备份文件恢复
- 可以删除新增的模块文件

✅ **修改范围明确**
- 只修改 `prompts.yaml` 中的因子研发阶段提示词
- 只简化 `factor_coder/prompts.yaml` 中的股票代码格式说明
- 不影响其他提示词内容

---

**确认可以开始修改提示词文件**
